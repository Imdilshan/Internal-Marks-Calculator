<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="icon" type="image/png" href="favicon.png" />
    <meta property="og:title" content="Internal Marks Calculator" />
    <meta property="og:description" content="Calculate Internal marks and Grade easily." />
    <meta property="og:type" content="website" />
    <meta property="og:url" content="https://imdilshan.github.io/Internal-Marks-Calculator/" />
    <meta property="og:image" content="https://imdilshan.github.io/Internal-Marks-Calculator/preview1.jpg" />
    <meta property="og:image:width" content="1200" />
    <meta property="og:image:height" content="630" />
    
    <meta name="twitter:card" content="summary_large_image" />
    <meta name="twitter:title" content="Internal Marks Calculator" />
    <meta name="twitter:description" content="Calculate Internal marks and Grade easily." />
    <meta name="twitter:image" content="https://imdilshan.github.io/Internal-Marks-Calculator/preview1.jpg" />
    <title>SGPA Estimator</title>
    <meta name="description" content="Estimate your SGPA with internal marks and projected external scores">
    <script src="https://cdn.jsdelivr.net/npm/canvas-confetti@1.9.2/dist/confetti.browser.min.js"></script>
    <style>
        /* ===== Design Tokens ===== */
        :root {
            --color-primary: #0066FF;
            --color-primary-700: #0047C1;
            --color-primary-100: #EAF2FF;
            --color-accent: #00C2A8;
            --color-accent-700: #00997A;
            --neutral-900: #0F1724;
            --neutral-700: #374151;
            --neutral-500: #6B7280;
            --neutral-400: #9CA3AF;
            --neutral-200: #E5E7EB;
            --neutral-100: #F3F4F6;
            --neutral-50: #FBFDFF;
            --success: #16A34A;
            --warning: #F59E0B;
            --danger: #DC2626;
            --font-sans: system-ui, -apple-system, "Segoe UI", Roboto, "Helvetica Neue", Arial;
            --fs-xxl: 36px;
            --fs-xl: 28px;
            --fs-lg: 22px;
            --fs-md: 18px;
            --fs-sm: 16px;
            --fs-xs: 13px;
            --leading-regular: 1.4;
            --space-1: 4px;
            --space-2: 8px;
            --space-3: 12px;
            --space-4: 16px;
            --space-5: 24px;
            --space-6: 32px;
            --radius-sm: 4px;
            --radius-md: 8px;
            --radius-lg: 12px;
            --shadow-1: 0 4px 10px rgba(15, 23, 36, 0.06);
            --shadow-2: 0 8px 30px rgba(15, 23, 36, 0.08);
        }

        [data-theme="dark"] {
            --color-primary: #3B82F6;
            --color-primary-700: #2563EB;
            --color-primary-100: #0a0a0a;
            --color-accent: #3B82F6;
            --color-accent-700: #2563EB;
            --neutral-900: #FFFFFF;
            --neutral-700: #E5E5E5;
            --neutral-500: #A3A3A3;
            --neutral-400: #737373;
            --neutral-200: #262626;
            --neutral-100: #171717;
            --neutral-50: #0a0a0a;
            --success: #22C55E;
            --warning: #F59E0B;
            --danger: #EF4444;
            --shadow-1: 0 4px 10px rgba(0, 0, 0, 0.5);
            --shadow-2: 0 8px 30px rgba(0, 0, 0, 0.8);
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        /* ===== Custom Scrollbar ===== */
        /* WebKit browsers (Chrome, Safari, Edge) */
        ::-webkit-scrollbar {
            width: 12px;
        }

        ::-webkit-scrollbar-track {
            background: var(--neutral-100);
            border-radius: var(--radius-lg);
            transition: background-color 800ms ease 400ms;
        }

        ::-webkit-scrollbar-thumb {
            background: linear-gradient(135deg, var(--color-primary), var(--color-primary-700));
            border-radius: var(--radius-lg);
            border: 2px solid var(--neutral-100);
            transition: background 800ms ease 400ms, border-color 800ms ease 400ms;
        }

        ::-webkit-scrollbar-thumb:hover {
            background: linear-gradient(135deg, var(--color-primary-700), var(--color-primary));
            transition: background 200ms ease;
        }

        /* Dark theme scrollbar */
        [data-theme="dark"] ::-webkit-scrollbar-track {
            background: var(--neutral-200);
        }

        [data-theme="dark"] ::-webkit-scrollbar-thumb {
            background: linear-gradient(135deg, var(--color-primary), var(--color-accent));
            border: 2px solid var(--neutral-200);
        }

        [data-theme="dark"] ::-webkit-scrollbar-thumb:hover {
            background: linear-gradient(135deg, var(--color-accent), var(--color-primary));
        }

        /* Firefox */
        html {
            scrollbar-width: auto;
            scrollbar-color: var(--color-primary) var(--neutral-100);
            transition: scrollbar-color 800ms ease 400ms;
        }

        [data-theme="dark"] html {
            scrollbar-color: var(--color-primary) var(--neutral-200);
        }

        body {
            font-family: var(--font-sans);
            background: linear-gradient(135deg, var(--color-primary) 0%, var(--color-primary-700) 100%);
            color: var(--neutral-900);
            line-height: var(--leading-regular);
            min-height: 100vh;
            padding: var(--space-4);
            transition: background 300ms ease;
        }

        [data-theme="dark"] body {
            background: #000000;
        }

        .header {
            text-align: center;
            color: white;
            padding: var(--space-6) 0;
            max-width: 1200px;
            margin: 0 auto;
            position: relative;
        }

        /* Developer Profiles Styles */
        .dev-profiles {
            position: absolute;
            top: 5%;
            right: 2%;
            z-index: 10;
        }

        .profile-stack {
            position: relative;
            width: 70px;
            height: 70px;
        }

        .profile-item {
            position: absolute;
            transition: transform 0.3s ease, box-shadow 0.3s ease;
        }

        .profile-item:first-child {
            top: 0;
            left: 0;
            z-index: 2;
        }

        .profile-item:last-child {
            top: 20px;
            left: 20px;
            z-index: 1;
        }

        .profile-img {
            width: 55px;
            height: 55px;
            border-radius: 50%;
            border: 3px solid white;
            transition: all 0.3s ease;
            cursor: pointer;
            display: block;
        }

        .profile-img.primary {
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.3);
        }

        .profile-img.secondary {
            width: 48px;
            height: 48px;
            border: 2px solid rgba(255, 255, 255, 0.8);
            box-shadow: 0 2px 8px rgba(0, 0, 0, 0.2);
        }

        .profile-item:hover .profile-img {
            transform: scale(1.1);
            box-shadow: 0 8px 25px rgba(0, 0, 0, 0.4);
        }

        .profile-item:hover {
            z-index: 5 !important;
        }

        /* Tooltip without arrow */
        .profile-item::before {
            content: attr(data-tooltip);
            position: absolute;
            bottom: -40px;
            left: 50%;
            transform: translateX(-50%);
            background: rgba(0, 0, 0, 0.9);
            color: white;
            padding: 8px 14px;
            border-radius: 8px;
            font-size: 13px;
            font-weight: 500;
            white-space: nowrap;
            opacity: 0;
            visibility: hidden;
            transition: all 0.3s ease;
            pointer-events: none;
        }

        .profile-item:hover::before {
            opacity: 1;
            visibility: visible;
        }

        /* Dark theme adjustments */
        [data-theme="dark"] .profile-img {
            border-color: var(--neutral-200);
        }

        [data-theme="dark"] .profile-img.secondary {
            border-color: rgba(255, 255, 255, 0.6);
        }

        [data-theme="dark"] .profile-item::before {
            background: rgba(255, 255, 255, 0.95);
            color: #333;
        }

        /* Mobile responsive */
        @media (max-width: 768px) {
            .dev-profiles {
                top: var(--space-2);
                right: var(--space-2);
            }
            
            .profile-stack {
                width: 60px;
                height: 60px;
            }
            
            .profile-img {
                width: 48px;
                height: 48px;
            }
            
            .profile-img.secondary {
                width: 42px;
                height: 42px;
            }
            
            .profile-item:last-child {
                top: 15px;
                left: 15px;
            }
        }

        .header h1 {
            font-size: var(--fs-xxl);
            font-weight: 700;
            margin-bottom: var(--space-2);
        }

        .header p {
            font-size: var(--fs-md);
            opacity: 0.95;
            max-width: 600px;
            margin: 0 auto;
        }

        .container {
            max-width: 1200px;
            margin: 0 auto;
            background: white;
            border-radius: var(--radius-lg);
            box-shadow: var(--shadow-2);
            overflow: visible;
            transition: background 300ms ease;
        }

        [data-theme="dark"] .container {
            background: var(--neutral-100);
        }

        /* Page Loader */
        .page-loader {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: #000;
            display: flex;
            align-items: center;
            justify-content: center;
            z-index: 9999;
            transition: opacity 0.5s ease, visibility 0.5s ease;
        }

        .page-loader.hidden {
            opacity: 0;
            visibility: hidden;
        }

        .loader {
            --dim: 3rem;
            width: var(--dim);
            height: var(--dim);
            position: relative;
            animation: spin988 2s linear infinite;
        }

        .loader .circle {
            --color: #3B82F6;
            --dim: 1.2rem;
            width: var(--dim);
            height: var(--dim);
            background-color: var(--color);
            border-radius: 50%;
            position: absolute;
        }

        .loader .circle:nth-child(1) {
            top: 0;
            left: 0;
        }

        .loader .circle:nth-child(2) {
            top: 0;
            right: 0;
        }

        .loader .circle:nth-child(3) {
            bottom: 0;
            left: 0;
        }

        .loader .circle:nth-child(4) {
            bottom: 0;
            right: 0;
        }

        @keyframes spin988 {
            0% {
                transform: scale(1) rotate(0);
            }
            20%, 25% {
                transform: scale(1.3) rotate(90deg);
            }
            45%, 50% {
                transform: scale(1) rotate(180deg);
            }
            70%, 75% {
                transform: scale(1.3) rotate(270deg);
            }
            95%, 100% {
                transform: scale(1) rotate(360deg);
            }
        }

        .subject-nav {
            display: flex;
            gap: 12px;
            z-index: 999;
        }
        
        /* Desktop: Vertical navigation on left */
        .subject-nav-desktop {
            position: fixed;
            left: 20px;
            top: 10vh;
            flex-direction: column;
        }
        
        /* Mobile: Horizontal navigation below header */
        .subject-nav-mobile {
            flex-direction: row;
            flex-wrap: wrap;
            justify-content: center;
            margin-top: var(--space-4);
            display: none;
        }
        
        /* Show/hide based on screen size */
        @media (min-width: 1025px) {
            .subject-nav-desktop {
                display: flex;
            }
            .subject-nav-mobile {
                display: none !important;
            }
        }
        
        @media (max-width: 1024px) {
            .subject-nav-desktop {
                display: none !important;
            }
            .subject-nav-mobile {
                display: flex;
            }
        }

        .subject-nav-btn {
            width: 40px;
            height: 40px;
            border-radius: 50%;
            background: rgba(255, 255, 255, 0.2);
            border: 2px solid rgba(255, 255, 255, 0.3);
            color: white;
            font-weight: 700;
            font-size: 14px;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: all 200ms ease;
            backdrop-filter: blur(10px);
            position: relative;
        }

        .subject-nav-btn .nav-number {
            position: relative;
            z-index: 1;
        }

        .subject-nav-btn .nav-tick {
            position: absolute;
            top: -2px;
            right: -2px;
            width: 16px;
            height: 16px;
            background: #22C55E;
            border-radius: 50%;
            padding: 2px;
            stroke: white;
            box-shadow: 0 2px 6px rgba(34, 197, 94, 0.4);
        }
        
        .subject-nav-btn .nav-big-tick {
            color: #ffffff;
            filter: drop-shadow(0 0 6px rgba(34, 197, 94, 0.4));
            animation: tickPop 0.3s ease-out;
        }
        
        @keyframes tickPop {
            0% { transform: scale(0); }
            50% { transform: scale(1.2); }
            100% { transform: scale(1); }
        }

        .subject-nav-btn.complete {
            border-color: #22C55E;
            background: rgba(34, 197, 94, 0.15);
        }
        
        .subject-nav-btn.full-complete {
            background: rgba(34, 197, 94, 0.25);
            box-shadow: 0 0 15px rgba(34, 197, 94, 0.3);
        }

        .subject-nav-btn:hover {
            transform: scale(1.15);
            background: rgba(255, 255, 255, 0.4);
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.2);
        }

        .subject-nav-btn.active {
            background: var(--color-accent);
            border-color: var(--color-accent);
            transform: scale(1.2);
        }

        /* Tooltip for nav buttons - Desktop only */
        .subject-nav-desktop .subject-nav-btn::after {
            content: attr(data-tooltip);
            position: absolute;
            left: 60px;
            background: rgba(0, 0, 0, 0.9);
            color: white;
            padding: 8px 12px;
            border-radius: 6px;
            font-size: 13px;
            font-weight: 600;
            white-space: nowrap;
            opacity: 0;
            pointer-events: none;
            transition: opacity 200ms ease;
            z-index: 1000;
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.3);
        }

        [data-theme="dark"] .subject-nav-desktop .subject-nav-btn::after {
            background: rgba(255, 255, 255, 0.95);
            color: #000;
        }

        .subject-nav-desktop .subject-nav-btn:hover::after {
            opacity: 1;
        }

        /* Arrow for tooltip - Desktop only */
        .subject-nav-desktop .subject-nav-btn::before {
            content: '';
            position: absolute;
            left: 52px;
            width: 0;
            height: 0;
            border-top: 6px solid transparent;
            border-bottom: 6px solid transparent;
            border-right: 6px solid rgba(0, 0, 0, 0.9);
            opacity: 0;
            pointer-events: none;
            transition: opacity 200ms ease;
            z-index: 1000;
        }

        [data-theme="dark"] .subject-nav-desktop .subject-nav-btn::before {
            border-right-color: rgba(255, 255, 255, 0.95);
        }

        .subject-nav-desktop .subject-nav-btn:hover::before {
            opacity: 1;
        }

        /* Help navigation - different style */
        .help-nav-btn {
            width: 45px;
            height: 45px;
            font-size: 13px;
            font-weight: 600;
        }

        .help-nav-btn::after {
            content: attr(data-tooltip);
            left: 65px;
            min-width: 120px;
        }

        .help-nav-btn::before {
            left: 57px;
        }

        @media (max-width: 768px) {
            .subject-nav {
                left: 10px;
                top: 15vh;
                gap: 8px;
            }

            .subject-nav-btn {
                width: 32px;
                height: 32px;
                font-size: 12px;
            }

            .help-nav-btn {
                width: 36px;
                height: 36px;
                font-size: 11px;
            }
        }

        .tabs {
            border-bottom: 2px solid var(--neutral-200);
            background: var(--neutral-50);
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        [data-theme="dark"] .tabs {
            background: #0a0a0a;
            border-bottom-color: var(--neutral-200);
        }

        .tab-list {
            display: flex;
            list-style: none;
            padding: 0 var(--space-5);
        }
        
        .tab-actions {
            display: flex;
            gap: var(--space-2);
            padding: 0 var(--space-5);
        }
        
        .action-icon-btn {
            padding: var(--space-3);
            background: none;
            border: 1px solid var(--neutral-300);
            border-radius: 8px;
            color: var(--neutral-600);
            cursor: pointer;
            transition: all 200ms;
            display: flex;
            align-items: center;
            justify-content: center;
        }
        
        .action-icon-btn:hover {
            background: var(--neutral-100);
            border-color: var(--color-primary);
            color: var(--color-primary);
            transform: translateY(-2px);
        }
        
        [data-theme="dark"] .action-icon-btn {
            border-color: var(--neutral-700);
            color: var(--neutral-400);
        }
        
        [data-theme="dark"] .action-icon-btn:hover {
            background: rgba(255, 255, 255, 0.05);
            border-color: var(--color-primary);
            color: var(--color-primary);
        }

        /* Hide Excel download button by default */
        #excel-download-btn {
            display: none;
        }

        .tab {
            padding: var(--space-4) var(--space-5);
            background: none;
            border: none;
            font-size: var(--fs-sm);
            font-weight: 600;
            color: var(--neutral-500);
            cursor: pointer;
            position: relative;
            transition: color 200ms;
            display: flex;
            align-items: center;
            gap: var(--space-2);
        }

        .tab:hover {
            color: var(--neutral-900);
        }

        .tab:focus-visible {
            outline: 3px solid rgba(0, 102, 255, 0.16);
            outline-offset: -3px;
        }

        .tab[aria-selected="true"] {
            color: var(--color-primary);
        }

        .tab[aria-selected="true"]::after {
            content: '';
            position: absolute;
            bottom: -2px;
            left: 0;
            right: 0;
            height: 2px;
            background: var(--color-primary);
        }

        /* Tab icon and text styling */

        .tab-icon svg {
            width: 20px !important;
            height: 20px !important;
            stroke: currentColor;
            transition: all 200ms;
        }

        .tab-text {
            display: inline;
            line-height: 1;
        }

        #tab-results {
            display: none;
            padding-left: var(--space-3);
            padding-right: var(--space-3);
        }

        #tab-results.show-tab {
            display: block;
        }

        .tab-panel {
            padding: var(--space-6);
            animation: fadeIn 300ms ease;
            overflow: visible;
        }

        .tab-panel[hidden] {
            display: none;
        }

        @keyframes fadeIn {
            from {
                opacity: 0;
                transform: translateY(8px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        @media (prefers-reduced-motion: reduce) {
            .tab-panel {
                animation: none;
            }
        }

        .subject-card {
            background: var(--neutral-50);
            border: 1px solid var(--neutral-200);
            border-radius: var(--radius-md);
            padding: var(--space-5);
            margin-bottom: var(--space-4);
            transition: box-shadow 200ms;
        }

        [data-theme="dark"] .subject-card {
            background: #0a0a0a;
            border-color: var(--neutral-200);
        }

        .subject-card:hover {
            box-shadow: var(--shadow-1);
        }

        .subject-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: var(--space-4);
            flex-wrap: wrap;
            gap: var(--space-3);
        }

        .subject-name {
            font-size: var(--fs-md);
            font-weight: 600;
            color: var(--neutral-900);
        }

        .subject-meta {
            display: flex;
            gap: var(--space-3);
            font-size: var(--fs-xs);
            color: var(--neutral-500);
        }

        .badge {
            background: var(--color-primary);
            color: white;
            padding: var(--space-1) var(--space-3);
            border-radius: var(--radius-sm);
            font-size: var(--fs-xs);
            font-weight: 500;
        }

        .components-grid {
            display: grid;
            gap: var(--space-3);
        }

        .component-name {
            font-size: var(--fs-sm);
            color: var(--neutral-700);
        }

        .component-max {
            font-size: var(--fs-sm);
            color: var(--neutral-500);
            font-weight: 600;
            white-space: nowrap;
        }

        input[type="number"] {
            width: 100px;
            max-width: 100px;
            padding: var(--space-2) var(--space-3);
            border: 2px solid var(--neutral-200);
            border-radius: var(--radius-sm);
            font-size: var(--fs-sm);
            transition: all 200ms;
            background: white;
            color: var(--neutral-900);
        }

        /* Remove default spinners */
        input[type="number"]::-webkit-inner-spin-button,
        input[type="number"]::-webkit-outer-spin-button {
            -webkit-appearance: none;
            margin: 0;
        }

        input[type="number"] {
            -moz-appearance: textfield;
            appearance: textfield;
        }

        /* Custom spinner container */
        .component-row {
            display: grid;
            grid-template-columns: 2fr auto auto;
            gap: var(--space-3);
            align-items: center;
            padding: var(--space-3);
            background: white;
            border-radius: var(--radius-sm);
            position: relative;
        }

        [data-theme="dark"] .component-row {
            background: var(--neutral-100);
        }

        /* Add custom spinner buttons */
        input[type="number"] {
            position: relative;
            padding-right: 36px;
            width: 100px;
            max-width: 100px;
        }

        /* Custom increment/decrement buttons using background */
        input[type="number"] {
            background-image: 
                url('data:image/svg+xml;utf8,<svg xmlns="http://www.w3.org/2000/svg" width="12" height="8" viewBox="0 0 12 8"><path fill="%230066FF" d="M6 0l6 8H0z"/></svg>'),
                url('data:image/svg+xml;utf8,<svg xmlns="http://www.w3.org/2000/svg" width="12" height="8" viewBox="0 0 12 8"><path fill="%230066FF" d="M6 8L0 0h12z"/></svg>');
            background-position: 
                calc(100% - 10px) 8px,
                calc(100% - 10px) calc(100% - 8px);
            background-size: 12px 8px, 12px 8px;
            background-repeat: no-repeat;
        }

        [data-theme="dark"] input[type="number"] {
            background-color: var(--neutral-50);
            border-color: var(--neutral-400);
            color: var(--neutral-900);
            background-image: 
                url('data:image/svg+xml;utf8,<svg xmlns="http://www.w3.org/2000/svg" width="12" height="8" viewBox="0 0 12 8"><path fill="%233B82F6" d="M6 0l6 8H0z"/></svg>'),
                url('data:image/svg+xml;utf8,<svg xmlns="http://www.w3.org/2000/svg" width="12" height="8" viewBox="0 0 12 8"><path fill="%233B82F6" d="M6 8L0 0h12z"/></svg>');
            background-position: 
                calc(100% - 10px) 8px,
                calc(100% - 10px) calc(100% - 8px);
            background-size: 12px 8px, 12px 8px;
            background-repeat: no-repeat;
        }

        input[type="number"]:hover {
            background-image: 
                url('data:image/svg+xml;utf8,<svg xmlns="http://www.w3.org/2000/svg" width="12" height="8" viewBox="0 0 12 8"><path fill="%2300C2A8" d="M6 0l6 8H0z"/></svg>'),
                url('data:image/svg+xml;utf8,<svg xmlns="http://www.w3.org/2000/svg" width="12" height="8" viewBox="0 0 12 8"><path fill="%2300C2A8" d="M6 8L0 0h12z"/></svg>');
        }

        [data-theme="dark"] input[type="number"]:hover {
            background-image: 
                url('data:image/svg+xml;utf8,<svg xmlns="http://www.w3.org/2000/svg" width="12" height="8" viewBox="0 0 12 8"><path fill="%2314B8A6" d="M6 0l6 8H0z"/></svg>'),
                url('data:image/svg+xml;utf8,<svg xmlns="http://www.w3.org/2000/svg" width="12" height="8" viewBox="0 0 12 8"><path fill="%2314B8A6" d="M6 8L0 0h12z"/></svg>');
        }

        input[type="number"]:focus {
            outline: none;
            border-color: var(--color-primary);
            box-shadow: 0 0 0 3px rgba(0, 102, 255, 0.1);
        }

        [data-theme="dark"] input[type="number"]:focus {
            box-shadow: 0 0 0 3px rgba(59, 130, 246, 0.2);
        }

        input[type="number"].error {
            border-color: var(--danger);
            background-color: rgba(220, 38, 38, 0.05);
            background-image: 
                url('data:image/svg+xml;utf8,<svg xmlns="http://www.w3.org/2000/svg" width="12" height="8" viewBox="0 0 12 8"><path fill="%23DC2626" d="M6 0l6 8H0z"/></svg>'),
                url('data:image/svg+xml;utf8,<svg xmlns="http://www.w3.org/2000/svg" width="12" height="8" viewBox="0 0 12 8"><path fill="%23DC2626" d="M6 8L0 0h12z"/></svg>');
        }

        [data-theme="dark"] input[type="number"].error {
            background-color: rgba(239, 68, 68, 0.1);
            background-image: 
                url('data:image/svg+xml;utf8,<svg xmlns="http://www.w3.org/2000/svg" width="12" height="8" viewBox="0 0 12 8"><path fill="%23EF4444" d="M6 0l6 8H0z"/></svg>'),
                url('data:image/svg+xml;utf8,<svg xmlns="http://www.w3.org/2000/svg" width="12" height="8" viewBox="0 0 12 8"><path fill="%23EF4444" d="M6 8L0 0h12z"/></svg>');
        }

        /* Attendance Toggle Switch */
        .checkbox-wrapper-63 input[type="checkbox"] {
            visibility: hidden;
            display: none;
        }

        .checkbox-wrapper-63 *,
        .checkbox-wrapper-63 ::after,
        .checkbox-wrapper-63 ::before {
            box-sizing: border-box;
        }

        .checkbox-wrapper-63 .switch {
            font-size: 1rem;
            position: relative;
            display: inline-block;
            width: 4em;
            height: 2em;
        }

        .checkbox-wrapper-63 .slider {
            position: absolute;
            cursor: pointer;
            inset: 0;
            background-color: #eee;
            transition: 0.4s;
            border-radius: 0.5em;
            box-shadow: 0 0.2em #dfd9d9;
        }

        .checkbox-wrapper-63 .slider:before {
            position: absolute;
            content: "";
            height: 1.5em;
            width: 1.4em;
            border-radius: 0.3em;
            left: 0.3em;
            bottom: 0.7em;
            background-color: lightsalmon;
            transition: 0.4s;
            box-shadow: 0 0.4em #bcb4b4;
        }

        .checkbox-wrapper-63 .slider:hover::before {
            box-shadow: 0 0.2em #bcb4b4;
            bottom: 0.5em;
        }

        .checkbox-wrapper-63 input:checked + .slider::before {
            transform: translateX(2em);
            background: lightgreen;
        }

        [data-theme="dark"] .checkbox-wrapper-63 .slider {
            background-color: #333;
            box-shadow: 0 0.2em #222;
        }

        [data-theme="dark"] .checkbox-wrapper-63 .slider:before {
            box-shadow: 0 0.4em #1a1a1a;
        }

        [data-theme="dark"] .checkbox-wrapper-63 .slider:hover::before {
            box-shadow: 0 0.2em #1a1a1a;
        }

        .external-section {
            margin-top: var(--space-4);
            padding: var(--space-4);
            background: var(--color-primary-100);
            border-radius: var(--radius-md);
            border: 2px dashed rgba(0, 102, 255, 0.3);
        }

        [data-theme="dark"] .external-section {
            background: #0d0d0d;
        }

        .external-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: var(--space-3);
            flex-wrap: wrap;
            gap: var(--space-3);
        }

        .external-title {
            font-size: var(--fs-sm);
            font-weight: 600;
            color: var(--neutral-900);
        }

        .scenario-buttons {
            display: flex;
            gap: var(--space-2);
            flex-wrap: wrap;
        }

        .btn-scenario {
            padding: var(--space-1) var(--space-3);
            background: white;
            border: 1px solid var(--color-primary);
            border-radius: var(--radius-sm);
            color: var(--color-primary);
            font-size: var(--fs-xs);
            font-weight: 500;
            cursor: pointer;
            transition: all 200ms;
        }

        [data-theme="dark"] .btn-scenario {
            background: var(--neutral-100);
            border-color: var(--color-primary);
            color: var(--color-primary);
        }

        .btn-scenario:hover {
            background: var(--color-primary);
            color: white;
        }

        .btn-scenario:focus-visible {
            outline: 3px solid rgba(0, 102, 255, 0.16);
        }

        .subject-summary {
            margin-top: var(--space-4);
            background: white;
            border-radius: var(--radius-sm);
            border: 2px solid var(--neutral-200);
            overflow: hidden;
        }

        [data-theme="dark"] .subject-summary {
            background: var(--neutral-100);
            border-color: var(--neutral-200);
        }

        .summary-table {
            width: 100%;
            border-collapse: collapse;
        }

        .summary-table th,
        .summary-table td {
            padding: var(--space-3);
            text-align: center;
            font-size: var(--fs-sm);
            border-right: 1px solid var(--neutral-200);
        }

        .summary-table th:last-child,
        .summary-table td:last-child {
            border-right: none;
        }

        .summary-table th {
            background: var(--neutral-100);
            font-weight: 600;
            color: var(--neutral-700);
            text-transform: uppercase;
            font-size: var(--fs-xs);
            letter-spacing: 0.5px;
        }

        [data-theme="dark"] .summary-table th {
            background: var(--neutral-50);
            color: var(--neutral-500);
        }

        .summary-table td {
            color: var(--neutral-900);
            font-weight: 600;
            background: white;
        }

        [data-theme="dark"] .summary-table td {
            background: var(--neutral-100);
        }

        .summary-table .grade-cell {
            background: var(--color-primary-100);
        }


        @media (max-width: 768px) {
            .summary-table {
                font-size: var(--fs-xs);
            }

            .summary-table th,
            .summary-table td {
                padding: var(--space-2);
            }
        }

        .grade-pill {
            display: inline-block;
            padding: var(--space-1) var(--space-3);
            background: linear-gradient(135deg, var(--color-primary), var(--color-primary-700));
            color: white;
            border-radius: var(--radius-md);
            font-weight: 700;
            font-size: var(--fs-md);
        }

        .btn {
            padding: var(--space-3) var(--space-5);
            border: none;
            border-radius: var(--radius-md);
            font-size: var(--fs-sm);
            font-weight: 600;
            cursor: pointer;
            transition: all 200ms;
            display: inline-flex;
            align-items: center;
            gap: var(--space-2);
        }

        .btn:focus-visible {
            outline: 3px solid rgba(0, 102, 255, 0.16);
            outline-offset: 2px;
        }

        .btn--cta {
            background: var(--color-accent);
            color: white;
            font-size: var(--fs-md);
            padding: var(--space-4) var(--space-6);
        }

        .btn--cta:hover {
            background: var(--color-accent-700);
            transform: translateY(-2px);
            box-shadow: var(--shadow-1);
        }

        .btn--secondary {
            background: white;
            color: var(--color-primary);
            border: 2px solid var(--color-primary);
        }

        .btn--secondary:hover {
            background: var(--color-primary-100);
        }

        .action-bar {
            display: flex;
            gap: var(--space-3);
            justify-content: space-between;
            align-items: center;
        }

        /* Calculate SGPA button styles */
        .action-bar button:last-child {
            padding: 0;
            margin: 0;
            border: none;
            background: none;
            cursor: pointer;
        }

        .action-bar button:last-child {
            --primary-color: #111;
            --hovered-color: #c84747;
            position: relative;
            display: flex;
            font-weight: 600;
            font-size: 20px;
            gap: 0.5rem;
            align-items: center;
        }

        .action-bar button:last-child p {
            margin: 0;
            position: relative;
            font-size: 20px;
            color: var(--primary-color);
        }

        .action-bar button:last-child::after {
            position: absolute;
            content: "";
            width: 0;
            left: 0;
            bottom: -7px;
            background: var(--hovered-color);
            height: 2px;
            transition: 0.3s ease-out;
        }

        .action-bar button:last-child p::before {
            position: absolute;
            width: 0%;
            inset: 0;
            color: var(--hovered-color);
            overflow: hidden;
            transition: 0.3s ease-out;
        }

        .action-bar button:last-child:hover::after {
            width: 100%;
        }

        .action-bar button:last-child:hover p::before {
            width: 100%;
        }

        .action-bar button:last-child:hover svg {
            transform: translateX(4px);
            color: var(--hovered-color);
        }

        .action-bar button:last-child svg {
            color: var(--primary-color);
            transition: 0.2s;
            position: relative;
            width: 15px;
            transition-delay: 0.2s;
        }

        [data-theme="dark"] .action-bar button:last-child {
            --primary-color: #fff;
            --hovered-color: #ff6b6b;
        }

        /* Apply same animated style to first button (CSV) */
        .action-bar button:first-child {
            padding: 0;
            margin: 0;
            border: none;
            background: none;
            cursor: pointer;
            --primary-color: #111;
            --hovered-color: #0066FF;
            position: relative;
            display: flex;
            font-weight: 600;
            font-size: 20px;
            gap: 0.5rem;
            align-items: center;
        }

        .action-bar button:first-child p {
            margin: 0;
            position: relative;
            font-size: 20px;
            color: var(--primary-color);
        }

        .action-bar button:first-child::after {
            position: absolute;
            content: "";
            width: 0;
            left: 0;
            bottom: -7px;
            background: var(--hovered-color);
            height: 2px;
            transition: 0.3s ease-out;
        }

        .action-bar button:first-child p::before {
            position: absolute;
            content: "";
            width: 0%;
            inset: 0;
            color: var(--hovered-color);
            overflow: hidden;
            transition: 0.3s ease-out;
        }

        .action-bar button:first-child:hover::after {
            width: 100%;
        }

        .action-bar button:first-child:hover p::before {
            width: 100%;
        }

        .action-bar button:first-child:hover svg {
            transform: translateY(4px);
            color: var(--hovered-color);
        }

        .action-bar button:first-child svg {
            color: var(--primary-color);
            transition: 0.2s;
            position: relative;
            width: 15px;
            transition-delay: 0.2s;
        }

        [data-theme="dark"] .action-bar button:first-child {
            --primary-color: #fff;
            --hovered-color: #3B82F6;
        }

        /* Toast Notification */
        .toast-container {
            position: fixed;
            top: 20px;
            right: 20px;
            z-index: 10000;
            display: flex;
            flex-direction: column;
            gap: var(--space-2);
            pointer-events: none;
        }

        .toast {
            background: white;
            color: var(--neutral-900);
            padding: var(--space-4) var(--space-5);
            border-radius: var(--radius-md);
            box-shadow: 0 10px 40px rgba(0, 0, 0, 0.15);
            display: flex;
            align-items: center;
            gap: var(--space-3);
            min-width: 300px;
            max-width: 400px;
            pointer-events: auto;
            animation: slideIn 0.3s ease-out;
            border-left: 4px solid;
        }

        .toast.success {
            border-left-color: #22C55E;
        }

        .toast.error {
            border-left-color: #EF4444;
        }

        .toast.warning {
            border-left-color: #F59E0B;
        }

        .toast-icon {
            flex-shrink: 0;
            width: 24px;
            height: 24px;
        }

        .toast.success .toast-icon {
            color: #22C55E;
        }

        .toast.error .toast-icon {
            color: #EF4444;
        }

        .toast.warning .toast-icon {
            color: #F59E0B;
        }

        .toast-content {
            flex: 1;
        }

        .toast-title {
            font-weight: 700;
            font-size: var(--fs-sm);
            margin-bottom: var(--space-1);
        }

        .toast-message {
            font-size: var(--fs-xs);
            color: var(--neutral-500);
            line-height: 1.4;
        }

        .toast-close {
            background: none;
            border: none;
            cursor: pointer;
            padding: 0;
            color: var(--neutral-400);
            transition: color 0.2s;
            flex-shrink: 0;
        }

        .toast-close:hover {
            color: var(--neutral-700);
        }

        [data-theme="dark"] .toast {
            background: #1a1a1a;
            color: white;
            box-shadow: 0 10px 40px rgba(0, 0, 0, 0.4);
        }

        [data-theme="dark"] .toast-message {
            color: var(--neutral-400);
        }

        [data-theme="dark"] .toast-close {
            color: var(--neutral-500);
        }

        [data-theme="dark"] .toast-close:hover {
            color: var(--neutral-300);
        }

        @keyframes slideIn {
            from {
                transform: translateX(400px);
                opacity: 0;
            }
            to {
                transform: translateX(0);
                opacity: 1;
            }
        }

        @keyframes slideOut {
            from {
                transform: translateX(0);
                opacity: 1;
            }
            to {
                transform: translateX(400px);
                opacity: 0;
            }
        }

        .toast.removing {
            animation: slideOut 0.3s ease-in forwards;
        }

        .results-hero {
            text-align: center;
            padding: var(--space-6);
            background: linear-gradient(135deg, var(--color-primary-100), var(--neutral-50));
            border-radius: var(--radius-lg);
            margin-bottom: var(--space-5);
            position: relative;
            overflow: hidden;
        }

        .results-hero::before {
            content: '';
            position: absolute;
            top: -50%;
            right: -50%;
            width: 200%;
            height: 200%;
            background: radial-gradient(circle, rgba(0, 102, 255, 0.05) 0%, transparent 70%);
            animation: pulse 4s ease-in-out infinite;
        }

        @keyframes pulse {
            0%, 100% { transform: scale(1); opacity: 0.5; }
            50% { transform: scale(1.1); opacity: 0.8; }
        }

        [data-theme="dark"] .results-hero {
            background: linear-gradient(135deg, #0d0d0d, #0a0a0a);
        }

        [data-theme="dark"] .results-hero::before {
            background: radial-gradient(circle, rgba(59, 130, 246, 0.1) 0%, transparent 70%);
        }

        .sgpa-display {
            font-size: 80px;
            font-weight: 800;
            background: linear-gradient(135deg, var(--color-primary), var(--color-primary-700));
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
            line-height: 1;
            margin: var(--space-3) 0;
            position: relative;
            z-index: 1;
            letter-spacing: -0.02em;
        }

        .sgpa-label {
            font-size: var(--fs-md);
            color: var(--neutral-500);
            font-weight: 600;
            text-transform: uppercase;
            letter-spacing: 1.5px;
            position: relative;
            z-index: 1;
        }

        .sgpa-grade-badge {
            display: inline-flex;
            align-items: center;
            gap: var(--space-2);
            padding: var(--space-2) var(--space-4);
            background: linear-gradient(135deg, var(--color-accent), var(--color-accent-700));
            color: white;
            border-radius: 50px;
            font-weight: 700;
            font-size: var(--fs-md);
            margin-top: var(--space-3);
            position: relative;
            z-index: 1;
            box-shadow: 0 4px 12px rgba(0, 194, 168, 0.3);
        }

        .results-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: var(--space-4);
            margin-bottom: var(--space-5);
        }

        .result-card {
            background: var(--neutral-50);
            padding: var(--space-5);
            border-radius: var(--radius-md);
            border: 2px solid var(--neutral-200);
            position: relative;
            overflow: hidden;
            transition: all 300ms ease;
        }

        .result-card::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            width: 4px;
            height: 100%;
            background: linear-gradient(180deg, var(--color-primary), var(--color-accent));
            opacity: 0;
            transition: opacity 300ms ease;
        }

        .result-card:hover {
            transform: translateY(-4px);
            box-shadow: var(--shadow-2);
            border-color: var(--color-primary);
        }

        .result-card:hover::before {
            opacity: 1;
        }

        [data-theme="dark"] .result-card {
            background: #0a0a0a;
            border-color: var(--neutral-200);
        }

        .result-label {
            font-size: var(--fs-xs);
            color: var(--neutral-500);
            text-transform: uppercase;
            letter-spacing: 0.8px;
            margin-bottom: var(--space-2);
            font-weight: 600;
            display: flex;
            align-items: center;
            gap: var(--space-2);
        }

        .result-value {
            font-size: var(--fs-xxl);
            font-weight: 800;
            color: var(--neutral-900);
            line-height: 1.2;
        }

        .breakdown-section {
            margin-top: var(--space-5);
        }

        .breakdown-header {
            display: flex;
            align-items: center;
            justify-content: space-between;
            margin-bottom: var(--space-4);
            flex-wrap: wrap;
            gap: var(--space-3);
        }

        .breakdown-header h3 {
            color: var(--neutral-900);
            font-size: var(--fs-lg);
            font-weight: 700;
            display: flex;
            align-items: center;
            gap: var(--space-2);
            margin: 0;
        }

        .breakdown-list {
            list-style: none;
            display: grid;
            gap: var(--space-3);
        }

        .breakdown-item {
            display: grid;
            grid-template-columns: auto 1fr auto;
            align-items: center;
            gap: var(--space-4);
            padding: var(--space-4);
            background: var(--neutral-50);
            border-radius: var(--radius-md);
            border: 1px solid var(--neutral-200);
            transition: all 200ms ease;
        }

        .breakdown-item:hover {
            box-shadow: var(--shadow-1);
            border-color: var(--color-primary);
            transform: translateX(4px);
        }

        [data-theme="dark"] .breakdown-item {
            background: #0a0a0a;
            border-color: var(--neutral-200);
        }

        .breakdown-icon {
            width: 48px;
            height: 48px;
            border-radius: var(--radius-md);
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: 700;
            font-size: var(--fs-md);
            background: linear-gradient(135deg, var(--color-primary-100), var(--neutral-100));
            color: var(--color-primary);
            flex-shrink: 0;
        }

        [data-theme="dark"] .breakdown-icon {
            background: linear-gradient(135deg, #1a1a1a, #0d0d0d);
        }

        .breakdown-info {
            display: flex;
            flex-direction: column;
            gap: var(--space-1);
            min-width: 0;
        }

        .breakdown-course {
            font-weight: 700;
            color: var(--neutral-900);
            font-size: var(--fs-sm);
            white-space: nowrap;
            overflow: hidden;
            text-overflow: ellipsis;
        }

        .breakdown-code {
            font-size: var(--fs-xs);
            color: var(--neutral-500);
            font-family: monospace;
        }

        .breakdown-stats {
            display: flex;
            flex-direction: column;
            align-items: flex-end;
            gap: var(--space-1);
            flex-shrink: 0;
        }

        .breakdown-calc {
            font-size: var(--fs-xs);
            color: var(--neutral-500);
            font-family: monospace;
        }

        .breakdown-grade {
            display: inline-flex;
            align-items: center;
            gap: var(--space-1);
            padding: var(--space-1) var(--space-3);
            background: linear-gradient(135deg, var(--color-primary), var(--color-primary-700));
            color: white;
            border-radius: 50px;
            font-weight: 700;
            font-size: var(--fs-xs);
        }

        .help-content {
            max-width: 800px;
            margin: 0 auto;
        }

        .help-section {
            margin-bottom: var(--space-5);
        }

        .help-section h3 {
            font-size: var(--fs-lg);
            color: var(--neutral-900);
            margin-bottom: var(--space-3);
        }

        .help-section h4 {
            color: var(--neutral-900);
        }

        .help-section p {
            color: var(--neutral-700);
            line-height: 1.6;
        }

        .formula-box {
            background: var(--neutral-50);
            padding: var(--space-4);
            border-radius: var(--radius-md);
            border-left: 4px solid var(--color-accent);
            font-family: monospace;
            font-size: var(--fs-sm);
            margin: var(--space-3) 0;
        }

        [data-theme="dark"] .formula-box {
            background: #0a0a0a;
            border-left-color: var(--color-accent);
        }

        @media (max-width: 768px) {
            .header h1 {
                font-size: var(--fs-xl);
            }

            .component-row {
                grid-template-columns: 1fr auto auto;
                gap: var(--space-2);
            }

            input[type="number"] {
                width: 90px;
                max-width: 90px;
            }

            .subject-header {
                flex-direction: column;
                align-items: flex-start;
            }

            .sgpa-display {
                font-size: 48px;
            }
        }

        @media (prefers-reduced-motion: reduce) {
            *,
            *::before,
            *::after {
                animation-duration: 0.01ms !important;
                animation-iteration-count: 1 !important;
                transition-duration: 0.01ms !important;
            }
        }

        .sr-only {
            position: absolute;
            width: 1px;
            height: 1px;
            padding: 0;
            margin: -1px;
            overflow: hidden;
            clip: rect(0, 0, 0, 0);
            white-space: nowrap;
            border-width: 0;
        }

        /* Mobile overrides - placed at end to ensure proper cascade */
        @media (max-width: 1024px) {
            .tab-panel {
                padding: var(--space-4);
            }

            /* Hide input arrow buttons on mobile */
            input[type="number"] {
                background-image: none !important;
                padding-right: var(--space-2);
            }

            /* Hide credit badges on mobile */
            .badge {
                display: none !important;
            }

            /* Hide tab text on mobile, show only icons */
            .tab-text {
                display: none;
            }

            .tab-icon {
                display: inline-flex;
            }

            .tab-icon svg {
                width: 20px !important;
                height: 20px !important;
            }

            /* Font size reductions for mobile */
            h1 {
                font-size: var(--fs-md);
            }

            h2 {
                font-size: var(--fs-sm);
            }

            .main-content h2,
            .tab-header h2 {
                font-size: var(--fs-sm);
            }

            .tab-buttons button {
                font-size: var(--fs-xs);
                padding: var(--space-2) var(--space-3);
            }

            .component-name {
                font-size: var(--fs-xs);
            }

            .component-max {
                font-size: var(--fs-xs);
            }

            input[type="number"] {
                font-size: var(--fs-xs);
                padding: var(--space-1) var(--space-2);
            }

            .scenario-buttons button {
                font-size: var(--fs-xs);
                padding: var(--space-2) var(--space-3);
            }

            .external-title {
                font-size: var(--fs-xs);
            }

            .results h3 {
                font-size: var(--fs-sm);
            }

            .result-item {
                font-size: var(--fs-xs);
            }

            /* Reduce table text size and padding on mobile */
            .summary-table {
                table-layout: fixed;
            }

            .summary-table th,
            .summary-table td {
                font-size: calc(var(--fs-xs) * 0.85);
                padding: 4px 6px;
                width: 25%;
            }

            .summary-table th {
                font-size: calc(var(--fs-xs) * 0.75);
                letter-spacing: 0.3px;
            }

            /* Button text visibility for mobile */
            .desktop-text {
                display: none;
            }

            .mobile-text {
                display: inline;
            }
        }

        /* Desktop text visibility - ensure it works on larger screens */
        @media (min-width: 1025px) {
            /* Show both icon and text on desktop */
            .tab-text {
                display: inline;
            }

            .tab-icon svg {
                width: 20px !important;
                height: 20px !important;
            }

            .desktop-text {
                display: inline;
            }

            .mobile-text {
                display: none;
            }
        }

        /* Custom Dropdown Menu for Social Internship */
        .si-dropdown-wrapper {
            position: relative;
            width: 100%;
        }

        .si-dropdown-wrapper .si-dropdown-label {
            padding: 12px 16px;
            background: #2d2f31;
            color: white;
            font-size: var(--fs-sm);
            font-variant: small-caps;
            cursor: pointer;
            display: block;
            border-radius: var(--radius-sm);
            user-select: none;
        }

        .si-dropdown-wrapper .si-dropdown-label::after {
            float: right;
            right: 10%;
            content: "+";
            font-size: 1em;
            transition: transform 0.3s ease;
        }

        .si-dropdown-wrapper .si-dropdown-slide {
            position: absolute;
            top: 100%;
            left: 0;
            right: 0;
            width: 100%;
            height: 0px;
            overflow: hidden;
            text-align: center;
            transition: height 0.3s ease;
            background: #ffffff;
            border: 1px solid #e5e5e5;
            border-radius: 0 0 var(--radius-sm) var(--radius-sm);
            z-index: 1000;
            margin: 0;
            padding: 0;
            list-style: none;
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
        }

        .si-dropdown-wrapper .si-dropdown-slide li {
            padding: 4px;
            list-style: none;
            cursor: pointer;
            transition: background 0.2s ease;
        }

        .si-dropdown-wrapper .si-dropdown-slide li:hover {
            background: rgba(0, 0, 0, 0.05);
        }

        [data-theme="dark"] .si-dropdown-wrapper .si-dropdown-slide li:hover {
            background: rgba(255, 255, 255, 0.1);
        }

        .si-dropdown-wrapper .si-dropdown-slide li a {
            text-decoration: none;
            color: #2d2f31;
            display: block;
            font-size: var(--fs-sm);
        }

        [data-theme="dark"] .si-dropdown-wrapper .si-dropdown-slide li a {
            color: #e5e5e5;
        }

        .si-dropdown-wrapper input[type="checkbox"] {
            position: absolute;
            opacity: 0;
            height: 0px;
            width: 0px;
            pointer-events: none;
        }

        .si-dropdown-wrapper input[type="checkbox"]:checked + .si-dropdown-label::after {
            transform: rotateZ(45deg);
        }

        .si-dropdown-wrapper input[type="checkbox"]:checked ~ .si-dropdown-slide {
            height: 192px;
        }

        [data-theme="dark"] .si-dropdown-wrapper .si-dropdown-label {
            background: #1a1a1a;
        }

        [data-theme="dark"] .si-dropdown-wrapper .si-dropdown-slide {
            background: #1a1a1a;
            border: 1px solid #404040;
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.3);
        }

        [data-theme="dark"] .si-dropdown-wrapper .si-dropdown-slide li a {
            color: #e5e5e5;
        }

        [data-theme="dark"] .si-dropdown-wrapper .si-dropdown-slide li a {
            color: #e5e5e5;
        }

        [data-theme="dark"] .si-dropdown-wrapper .si-dropdown-slide li:hover {
            background: rgba(255, 255, 255, 0.05);
        }
    </style>
</head>
<body>
    <!-- Page Loader -->
    <div class="page-loader" id="page-loader">
        <div class="loader">
            <div class="circle"></div>
            <div class="circle"></div>
            <div class="circle"></div>
            <div class="circle"></div>
        </div>
    </div>
    
    <div class="subject-nav subject-nav-desktop" id="subject-nav"></div>

    <!-- Developer Profiles -->
        <div class="dev-profiles">
            <div class="profile-stack">
                <div class="profile-item" data-tooltip="Imdilshan">
                    <a href="https://github.com/Imdilshan" target="_blank" rel="noopener noreferrer">
                        <img src="https://github.com/Imdilshan.png" alt="Imdilshan" class="profile-img secondary">
                    </a>
                </div>
                <div class="profile-item" data-tooltip="DevRanbir">
                    <a href="https://github.com/DevRanbir" target="_blank" rel="noopener noreferrer">
                        <img src="https://github.com/DevRanbir.png" alt="DevRanbir" class="profile-img primary">
                    </a>
                </div>
            </div>
        </div>

    <header class="header">
        

        <h1>Estimate your <br> <span style="font-size: 1.5em; font-weight: 900; font-family: 'Lucida Console', 'Courier New', monospace;">SGPA or Internals</span></h1>
        <p>Enter your internals, add projected external marks, and get immediate SGPA estimates with scenarios and export.
            <br /><u style="margin-top: 4px; display: inline-block;">Made for 3rd Sem CSE Gen students of CU</u>
        </p>
        <div class="subject-nav subject-nav-mobile" id="subject-nav-mobile"></div>
    </header>

    <main class="container">
        <nav class="tabs">
            <ul class="tab-list" role="tablist">
                <li role="presentation">
                    <button class="tab" role="tab" aria-selected="true" aria-controls="panel-inputs" id="tab-inputs" tabindex="0">
                        <span class="tab-icon">
                            <svg aria-hidden="true" xmlns="http://www.w3.org/2000/svg" width="24" height="24" fill="none" viewBox="0 0 24 24">
                                <path stroke="currentColor" stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 5v14m-8-7h2m0 0h2m-2 0v2m0-2v-2m12 1h-6m6 4h-6M4 19h16c.5523 0 1-.4477 1-1V6c0-.55228-.4477-1-1-1H4c-.55228 0-1 .44772-1 1v12c0 .5523.44772 1 1 1Z"/>
                            </svg>
                        </span>
                        <span class="tab-text">Inputs</span>
                    </button>
                </li>
                <li role="presentation">
                    <button class="tab" role="tab" aria-selected="false" aria-controls="panel-results" id="tab-results" tabindex="-1">
                        <span class="tab-icon">
                            <svg aria-hidden="true" xmlns="http://www.w3.org/2000/svg" width="18" height="24" fill="none" viewBox="0 0 24 24">
                                <path stroke="currentColor" stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="m7.171 12.906-2.153 6.411 2.672-.89 1.568 2.34 1.825-5.183m5.73-2.678 2.154 6.411-2.673-.89-1.568 2.34-1.825-5.183M9.165 4.3c.58.068 1.153-.17 1.515-.628a1.681 1.681 0 0 1 2.64 0 1.68 1.68 0 0 0 1.515.628 1.681 1.681 0 0 1 1.866 1.866c-.068.58.17 1.154.628 1.516a1.681 1.681 0 0 1 0 2.639 1.682 1.682 0 0 0-.628 1.515 1.681 1.681 0 0 1-1.866 1.866 1.681 1.681 0 0 0-1.516.628 1.681 1.681 0 0 1-2.639 0 1.681 1.681 0 0 0-1.515-.628 1.681 1.681 0 0 1-1.867-1.866 1.681 1.681 0 0 0-.627-1.515 1.681 1.681 0 0 1 0-2.64c.458-.361.696-.935.627-1.515A1.681 1.681 0 0 1 9.165 4.3ZM14 9a2 2 0 1 1-4 0 2 2 0 0 1 4 0Z"/>
                            </svg>
                        </span>
                        <span class="tab-text">Result</span>
                    </button>
                </li>
                <li role="presentation">
                    <button class="tab" role="tab" aria-selected="false" aria-controls="panel-help" id="tab-help" tabindex="-1">
                        <span class="tab-icon">
                            <svg aria-hidden="true" xmlns="http://www.w3.org/2000/svg" width="24" height="24" fill="none" viewBox="0 0 24 24">
                                <path stroke="currentColor" stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 13V8m0 8h.01M21 12a9 9 0 1 1-18 0 9 9 0 0 1 18 0Z"/>
                            </svg>
                        </span>
                        <span class="tab-text">Help</span>
                    </button>
                </li>
            </ul>
            
            <div class="tab-actions">
                <button class="action-icon-btn" onclick="importCSV()" aria-label="Import CSV" title="Import CSV">
                    <svg class="w-6 h-6 text-gray-800 dark:text-white" aria-hidden="true" xmlns="http://www.w3.org/2000/svg" width="24" height="24" fill="none" viewBox="0 0 24 24">
                        <path stroke="currentColor" stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 5v9m-5 0H5a1 1 0 0 0-1 1v4a1 1 0 0 0 1 1h14a1 1 0 0 0 1-1v-4a1 1 0 0 0-1-1h-2M8 9l4-5 4 5m1 8h.01"/>
                    </svg>

                </button>
                <button class="action-icon-btn" onclick="downloadTemplateCSV()" aria-label="Download CSV Template" title="Download CSV Template">
                    <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                        <path d="M14 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V8z"></path>
                        <polyline points="14 2 14 8 20 8"></polyline>
                        <line x1="12" y1="18" x2="12" y2="12"></line>
                        <line x1="9" y1="15" x2="15" y2="15"></line>
                    </svg>
                </button>
                <button class="action-icon-btn" onclick="downloadExcel()" id="excel-download-btn" aria-label="Download Excel file" title="Download Excel file (.xlsx)">
                    <svg class="w-6 h-6 text-gray-800 dark:text-white" aria-hidden="true" xmlns="http://www.w3.org/2000/svg" width="24" height="24" fill="currentColor" viewBox="0 0 24 24">
                        <path fill-rule="evenodd" d="M13 11.15V4a1 1 0 1 0-2 0v7.15L8.78 8.374a1 1 0 1 0-1.56 1.25l4 5a1 1 0 0 0 1.56 0l4-5a1 1 0 1 0-1.56-1.25L13 11.15Z" clip-rule="evenodd"/>
                        <path fill-rule="evenodd" d="M9.657 15.874 7.358 13H5a2 2 0 0 0-2 2v4a2 2 0 0 0 2 2h14a2 2 0 0 0 2-2v-4a2 2 0 0 0-2-2h-2.358l-2.3 2.874a3 3 0 0 1-4.685 0ZM17 16a1 1 0 1 0 0 2h.01a1 1 0 1 0 0-2H17Z" clip-rule="evenodd"/>
                    </svg>
                </button>
                <button class="action-icon-btn" onclick="toggleTheme(event)" aria-label="Toggle dark mode" title="Toggle dark mode">
                    <svg id="theme-icon-light" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" style="display: none;">
                        <circle cx="12" cy="12" r="5"></circle>
                        <line x1="12" y1="1" x2="12" y2="3"></line>
                        <line x1="12" y1="21" x2="12" y2="23"></line>
                        <line x1="4.22" y1="4.22" x2="5.64" y2="5.64"></line>
                        <line x1="18.36" y1="18.36" x2="19.78" y2="19.78"></line>
                        <line x1="1" y1="12" x2="3" y2="12"></line>
                        <line x1="21" y1="12" x2="23" y2="12"></line>
                        <line x1="4.22" y1="19.78" x2="5.64" y2="18.36"></line>
                        <line x1="18.36" y1="5.64" x2="19.78" y2="4.22"></line>
                    </svg>
                    <svg id="theme-icon-dark" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                        <path d="M21 12.79A9 9 0 1 1 11.21 3 7 7 0 0 0 21 12.79z"></path>
                    </svg>
                </button>
            </div>
        </nav>

        <div id="panel-inputs" role="tabpanel" aria-labelledby="tab-inputs" class="tab-panel">
            <div id="subjects-container"></div>
            <div class="action-bar">
                <button onclick="downloadDetailedCSV()">
                    <p>Save as CSV</p>
                    <svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="4">
                        <path stroke-linecap="round" stroke-linejoin="round" d="M4 16v1a3 3 0 003 3h10a3 3 0 003-3v-1m-4-4l-4 4m0 0l-4-4m4 4V4"></path>
                    </svg>
                </button>
                <button onclick="calculateSGPA()">
                    <p>Calculate SGPA</p>
                    <svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="4">
                        <path stroke-linecap="round" stroke-linejoin="round" d="M14 5l7 7m0 0l-7 7m7-7H3"></path>
                    </svg>
                </button>
            </div>
        </div>

        <!-- Toast Container -->
        <div class="toast-container" id="toast-container"></div>

        <div id="panel-results" role="tabpanel" aria-labelledby="tab-results" class="tab-panel" hidden>
            <div class="results-hero">
                <div class="sgpa-label">Your Estimated SGPA</div>
                <div class="sgpa-display" id="sgpa-value">0.00</div>
                <div class="sgpa-grade-badge" id="sgpa-grade-badge" style="display: none;">
                    <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5" stroke-linecap="round" stroke-linejoin="round">
                        <path d="M12 2l3.09 6.26L22 9.27l-5 4.87 1.18 6.88L12 17.77l-6.18 3.25L7 14.14 2 9.27l6.91-1.01L12 2z"></path>
                    </svg>
                    <span id="overall-grade">-</span>
                </div>
                <div role="status" aria-live="polite" class="sr-only" id="sgpa-announcement"></div>
            </div>

            <div class="results-grid">
                <div class="result-card">
                    <div class="result-label">
                        <svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                            <circle cx="12" cy="12" r="10"></circle>
                            <polyline points="12 6 12 12 16 14"></polyline>
                        </svg>
                        Total Credits
                    </div>
                    <div class="result-value" id="total-credits">23</div>
                </div>
                <div class="result-card">
                    <div class="result-label">
                        <svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                            <path d="M14 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V8z"></path>
                            <polyline points="14 2 14 8 20 8"></polyline>
                            <line x1="16" y1="13" x2="8" y2="13"></line>
                            <line x1="16" y1="17" x2="8" y2="17"></line>
                        </svg>
                        Total Marks you earned
                    </div>
                    <div class="result-value" id="total-marks">0</div>
                </div>

            </div>

            <div class="breakdown-section">
                <div class="breakdown-header">
                    <h3>
                        <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                            <path d="M4 19.5A2.5 2.5 0 0 1 6.5 17H20"></path>
                            <path d="M6.5 2H20v20H6.5A2.5 2.5 0 0 1 4 19.5v-15A2.5 2.5 0 0 1 6.5 2z"></path>
                        </svg>
                        Subject-wise Breakdown
                    </h3>
                </div>
                <ul class="breakdown-list" id="breakdown-list"></ul>
            </div>

            <div class="action-bar" style="margin-top: var(--space-4); justify-content: center;">
                <button onclick="downloadSummaryCSV()">
                    <p>Save as CSV</p>
                    <svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="4">
                        <path stroke-linecap="round" stroke-linejoin="round" d="M4 16v1a3 3 0 003 3h10a3 3 0 003-3v-1m-4-4l-4 4m0 0l-4-4m4 4V4"></path>
                    </svg>
                </button>
            </div>
        </div>

        <div id="panel-help" role="tabpanel" aria-labelledby="tab-help" class="tab-panel" hidden>
            <div class="help-content">
                <div class="help-section" id="help-sgpa">
                    <h3>
                        <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" style="display: inline-block; vertical-align: middle; margin-right: 8px;">
                            <line x1="18" y1="20" x2="18" y2="10"></line>
                            <line x1="12" y1="20" x2="12" y2="4"></line>
                            <line x1="6" y1="20" x2="6" y2="14"></line>
                        </svg>
                        How SGPA is Calculated
                    </h3>
                    <p>SGPA (Semester Grade Point Average) is calculated using the weighted average of grade points across all courses, where each course's contribution depends on its credit value.</p>
                    <div class="formula-box">
                        SGPA = (Grade Point  Credits) / (Credits)
                    </div>
                    <p style="margin-top: var(--space-3); font-size: var(--fs-sm); color: var(--neutral-500); font-style: italic;">
                        Example: If you score 98% (A+ = 10 GP) in a 4-credit subject and 92% (A = 9 GP) in a 3-credit subject:<br>
                        SGPA = (104 + 93) / (4+3) = 67/7 = 9.57
                    </p>
                </div>

                <div class="help-section" id="help-grades">
                    <h3>
                        <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" style="display: inline-block; vertical-align: middle; margin-right: 8px;">
                            <path d="M22 10v6M2 10l10-5 10 5-10 5z"></path>
                            <path d="M6 12v5c3 3 9 3 12 0v-5"></path>
                        </svg>
                        Grade Scale & Grade Points
                    </h3>
                    <p style="margin-bottom: var(--space-4);">Your percentage marks are converted to letter grades, and each grade has a corresponding <strong>Grade Point (GP)</strong> that is used to calculate your SGPA.</p>
                    
                    <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(280px, 1fr)); gap: var(--space-3); margin-top: var(--space-4);">
                        <div style="background: linear-gradient(135deg, #22C55E 0%, #16A34A 100%); padding: var(--space-4); border-radius: var(--radius-md); color: white;">
                            <div style="font-size: var(--fs-xs); opacity: 0.9; margin-bottom: var(--space-1);">96-100%</div>
                            <div style="font-size: var(--fs-xl); font-weight: 700; margin-bottom: var(--space-1);">A+ Grade</div>
                            <div style="font-size: var(--fs-sm); opacity: 0.95;">Outstanding  10 GP</div>
                        </div>
                        
                        <div style="background: linear-gradient(135deg, #3B82F6 0%, #2563EB 100%); padding: var(--space-4); border-radius: var(--radius-md); color: white;">
                            <div style="font-size: var(--fs-xs); opacity: 0.9; margin-bottom: var(--space-1);">90-95%</div>
                            <div style="font-size: var(--fs-xl); font-weight: 700; margin-bottom: var(--space-1);">A Grade</div>
                            <div style="font-size: var(--fs-sm); opacity: 0.95;">Excellent  9 GP</div>
                        </div>
                        
                        <div style="background: linear-gradient(135deg, #8B5CF6 0%, #7C3AED 100%); padding: var(--space-4); border-radius: var(--radius-md); color: white;">
                            <div style="font-size: var(--fs-xs); opacity: 0.9; margin-bottom: var(--space-1);">85-89%</div>
                            <div style="font-size: var(--fs-xl); font-weight: 700; margin-bottom: var(--space-1);">B+ Grade</div>
                            <div style="font-size: var(--fs-sm); opacity: 0.95;">Very Good  8 GP</div>
                        </div>
                        
                        <div style="background: linear-gradient(135deg, #14B8A6 0%, #0D9488 100%); padding: var(--space-4); border-radius: var(--radius-md); color: white;">
                            <div style="font-size: var(--fs-xs); opacity: 0.9; margin-bottom: var(--space-1);">60-84%</div>
                            <div style="font-size: var(--fs-xl); font-weight: 700; margin-bottom: var(--space-1);">B Grade</div>
                            <div style="font-size: var(--fs-sm); opacity: 0.95;">Good  7 GP</div>
                        </div>
                        
                        <div style="background: linear-gradient(135deg, #F59E0B 0%, #D97706 100%); padding: var(--space-4); border-radius: var(--radius-md); color: white;">
                            <div style="font-size: var(--fs-xs); opacity: 0.9; margin-bottom: var(--space-1);">50-59%</div>
                            <div style="font-size: var(--fs-xl); font-weight: 700; margin-bottom: var(--space-1);">C+ Grade</div>
                            <div style="font-size: var(--fs-sm); opacity: 0.95;">Above Average  6 GP</div>
                        </div>
                        
                        <div style="background: linear-gradient(135deg, #F97316 0%, #EA580C 100%); padding: var(--space-4); border-radius: var(--radius-md); color: white;">
                            <div style="font-size: var(--fs-xs); opacity: 0.9; margin-bottom: var(--space-1);">40-49%</div>
                            <div style="font-size: var(--fs-xl); font-weight: 700; margin-bottom: var(--space-1);">C Grade</div>
                            <div style="font-size: var(--fs-sm); opacity: 0.95;">Average  5 GP</div>
                        </div>
                        
                        <div style="background: linear-gradient(135deg, #6B7280 0%, #4B5563 100%); padding: var(--space-4); border-radius: var(--radius-md); color: white;">
                            <div style="font-size: var(--fs-xs); opacity: 0.9; margin-bottom: var(--space-1);">35-39%</div>
                            <div style="font-size: var(--fs-xl); font-weight: 700; margin-bottom: var(--space-1);">D Grade</div>
                            <div style="font-size: var(--fs-sm); opacity: 0.95;">Pass  4 GP</div>
                        </div>
                        
                        <div style="background: linear-gradient(135deg, #EF4444 0%, #DC2626 100%); padding: var(--space-4); border-radius: var(--radius-md); color: white;">
                            <div style="font-size: var(--fs-xs); opacity: 0.9; margin-bottom: var(--space-1);">0-34%</div>
                            <div style="font-size: var(--fs-xl); font-weight: 700; margin-bottom: var(--space-1);">E/F Grade</div>
                            <div style="font-size: var(--fs-sm); opacity: 0.95;">Fail  0 GP</div>
                        </div>
                    </div>
                    
                    <div style="margin-top: var(--space-5); padding: var(--space-4); background: var(--color-primary-100); border-left: 4px solid var(--color-primary); border-radius: var(--radius-md);">
                        <h4 style="margin-bottom: var(--space-2); color: var(--neutral-900); font-size: var(--fs-md);">
                            <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" style="display: inline-block; vertical-align: middle; margin-right: 6px;">
                                <circle cx="12" cy="12" r="10"></circle>
                                <path d="M9.09 9a3 3 0 0 1 5.83 1c0 2-3 3-3 3"></path>
                                <line x1="12" y1="17" x2="12.01" y2="17"></line>
                            </svg>
                            What are Grade Points?
                        </h4>
                        <p style="color: var(--neutral-700); font-size: var(--fs-sm); line-height: 1.6;">
                            <strong>Grade Points (GP)</strong> are numerical values assigned to letter grades. They standardize performance across different subjects, making it easy to calculate your overall academic standing. The higher your percentage, the better your grade, and the more grade points you earn. These grade points are multiplied by the subject's credits and averaged to give you your SGPA.
                        </p>
                    </div>
                </div>

                <div class="help-section" id="help-scenarios">
                    <h3>
                        <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" style="display: inline-block; vertical-align: middle; margin-right: 8px;">
                            <polygon points="13 2 3 14 12 14 11 22 21 10 12 10 13 2"></polygon>
                        </svg>
                        Quick Estimation Scenarios
                    </h3>
                    <p style="margin-bottom: var(--space-4);">Use the scenario buttons (Low/Mid/High) to instantly fill in estimated external exam marks and see how different performance levels affect your SGPA.</p>
                    
                    <div style="display: grid; gap: var(--space-3);">
                        <div style="display: flex; align-items: start; gap: var(--space-3); padding: var(--space-3); background: var(--neutral-50); border-radius: var(--radius-md); border: 1px solid var(--neutral-200);">
                            <div style="background: #FEE2E2; color: #991B1B; padding: var(--space-2); border-radius: var(--radius-sm); font-weight: 700; min-width: 60px; text-align: center;">Low</div>
                            <div style="flex: 1;">
                                <div style="font-weight: 600; color: var(--neutral-900); margin-bottom: var(--space-1);">Conservative Estimate</div>
                                <div style="font-size: var(--fs-sm); color: var(--neutral-700);">Assumes you'll score <strong>50%</strong> in external exams. Use this for a safe, worst-case scenario to see minimum expected SGPA.</div>
                            </div>
                        </div>
                        
                        <div style="display: flex; align-items: start; gap: var(--space-3); padding: var(--space-3); background: var(--neutral-50); border-radius: var(--radius-md); border: 1px solid var(--neutral-200);">
                            <div style="background: #FEF3C7; color: #92400E; padding: var(--space-2); border-radius: var(--radius-sm); font-weight: 700; min-width: 60px; text-align: center;">Mid</div>
                            <div style="flex: 1;">
                                <div style="font-weight: 600; color: var(--neutral-900); margin-bottom: var(--space-1);">Realistic Estimate</div>
                                <div style="font-size: var(--fs-sm); color: var(--neutral-700);">Assumes you'll score <strong>70%</strong> in external exams. A balanced estimate for average performance in finals.</div>
                            </div>
                        </div>
                        
                        <div style="display: flex; align-items: start; gap: var(--space-3); padding: var(--space-3); background: var(--neutral-50); border-radius: var(--radius-md); border: 1px solid var(--neutral-200);">
                            <div style="background: #D1FAE5; color: #065F46; padding: var(--space-2); border-radius: var(--radius-sm); font-weight: 700; min-width: 60px; text-align: center;">High</div>
                            <div style="flex: 1;">
                                <div style="font-weight: 600; color: var(--neutral-900); margin-bottom: var(--space-1);">Optimistic Estimate</div>
                                <div style="font-size: var(--fs-sm); color: var(--neutral-700);">Assumes you'll score <strong>85%</strong> in external exams. Your target if you're aiming for excellent performance.</div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </main>

    <script>
        const subjects = [
            {
                name: "Universal Human Values, Ethics and Life Skills-2",
                code: "24UCT-296",
                credits: 2,
                components: [
                    { name: "Attendance Marks", max: 2, obtained: 0 },
                    { name: "Assignment/PBL", max: 18, obtained: 0 },
                    { name: "Class Activity", max: 20, obtained: 0 }
                ],
                externals: [
                    { name: "External Theory", max: 60, obtained: 0 }
                ]
            },
            {
                name: "Advanced Data Structures and Algorithms",
                code: "24CSH-202",
                credits: 4,
                components: [
                    { name: "Attendance Marks", max: 2, obtained: 0 },
                    { name: "MST-1 Hybrid", max: 20, obtained: 0 },
                    { name: "MST-2 Hybrid", max: 20, obtained: 0 },
                    { name: "Experiment 1(CSE)", max: 30, obtained: 0 },
                    { name: "Experiment 2(CSE)", max: 30, obtained: 0 },
                    { name: "Experiment 3(CSE)", max: 30, obtained: 0 },
                    { name: "Experiment 4(CSE)", max: 30, obtained: 0 },
                    { name: "Class Performance(CSE)", max: 10, obtained: 0 },
                    { name: "Assignment/PBL", max: 10, obtained: 0 },
                    { name: "Quiz", max: 4, obtained: 0 },
                    { name: "Surprise Test(CSE)", max: 12, obtained: 0 },
                    { name: "Course Project", max: 5, obtained: 0 },
                    { name: "Industry Aligned Assessment(Hybrid)", max: 10, obtained: 0 }
                ],
                externals: [
                    { name: "End Term Assessment TH(CSE)", max: 60, obtained: 0 },
                    { name: "End Term Assessment Pr(CSE)", max: 40, obtained: 0 }
                ]
            },
            {
                name: "Database Management System",
                code: "24CSH-204",
                credits: 4,
                components: [
                    { name: "Attendance Marks", max: 2, obtained: 0 },
                    { name: "MST-1 Hybrid", max: 20, obtained: 0 },
                    { name: "MST-2 Hybrid", max: 20, obtained: 0 },
                    { name: "Experiment 1(CSE)", max: 30, obtained: 0 },
                    { name: "Experiment 2(CSE)", max: 30, obtained: 0 },
                    { name: "Experiment 3(CSE)", max: 30, obtained: 0 },
                    { name: "Experiment 4(CSE)", max: 30, obtained: 0 },
                    { name: "Class Performance(CSE)", max: 10, obtained: 0 },
                    { name: "Assignment/PBL", max: 10, obtained: 0 },
                    { name: "Quiz", max: 4, obtained: 0 },
                    { name: "Surprise Test(CSE)", max: 12, obtained: 0 },
                    { name: "Course Project", max: 5, obtained: 0 },
                    { name: "Industry Aligned Assessment(Hybrid)", max: 10, obtained: 0 }
                ],
                externals: [
                    { name: "End Term Assessment TH(CSE)", max: 60, obtained: 0 },
                    { name: "End Term Assessment Pr(CSE)", max: 40, obtained: 0 }
                ]
            },
            {
                name: "Python Programming",
                code: "24CSP-203",
                credits: 2,
                components: [
                    { name: "Class Performance", max: 10, obtained: 0 },
                    { name: "Experiment 1", max: 30, obtained: 0 },
                    { name: "Experiment 2", max: 30, obtained: 0 },
                    { name: "Experiment 3", max: 30, obtained: 0 },
                    { name: "Experiment 4", max: 30, obtained: 0 },
                    { name: "Mini Project", max: 5, obtained: 0 },
                    { name: "Industry Aligned Assessment", max: 10, obtained: 0 }
                ],
                externals: [
                    { name: "External Viva / Voce", max: 40, obtained: 0 }
                ]
            },
            {
                name: "Computer Organization and Architecture",
                code: "24CST-201",
                credits: 3,
                components: [
                    { name: "Attendance Marks", max: 2, obtained: 0 },
                    { name: "Assignment/PBL", max: 10, obtained: 0 },
                    { name: "Mid-Semester Test-1", max: 20, obtained: 0 },
                    { name: "Quiz", max: 4, obtained: 0 },
                    { name: "Surprise Test", max: 12, obtained: 0 },
                    { name: "Mid-Semester Test-2", max: 20, obtained: 0 }
                ],
                externals: [
                    { name: "External Theory", max: 60, obtained: 0 }
                ]
            },
            {
                name: "Discrete Mathematics",
                code: "24SMT-242",
                credits: 4,
                components: [
                    { name: "Attendance Marks", max: 2, obtained: 0 },
                    { name: "Assignment/PBL", max: 10, obtained: 0 },
                    { name: "Mid-Semester Test-1", max: 20, obtained: 0 },
                    { name: "Quiz", max: 4, obtained: 0 },
                    { name: "Surprise Test", max: 12, obtained: 0 },
                    { name: "Mid-Semester Test-2", max: 20, obtained: 0 }
                ],
                externals: [
                    { name: "External Theory", max: 60, obtained: 0 }
                ]
            },
            {
                name: "Soft Skills-1",
                code: "24TDP-211",
                credits: 1,
                components: [
                    { name: "Attendance and Engagement Score", max: 4, obtained: 0 },
                    { name: "Write X (Soft Skills)", max: 10, obtained: 0 },
                    { name: "LIVE Assignment (Soft Skills)", max: 30, obtained: 0 },
                    { name: "Presentation (Soft Skills)", max: 10, obtained: 0 },
                    { name: "Quiz (Soft Skills)", max: 6, obtained: 0 }
                ],
                externals: [
                    { name: "External Viva / Voce", max: 40, obtained: 0 }
                ]
            },
            {
                name: "Four G P",
                code: "24GP-101",
                credits: 1,
                components: [
                    { name: "Completion", max: 10, obtained: 0, isGradeInput: true }
                ],
                externals: []
            },
            {
                name: "Social Internship",
                code: "24SI-101",
                credits: 2,
                components: [
                    { name: "Grade", max: 10, obtained: 0, isGradeInput: true }
                ],
                externals: []
            }
        ];

        function getGrade(percentage) {
            if (percentage >= 96) return { grade: 'A+', point: 10 };
            if (percentage >= 90) return { grade: 'A', point: 9 };
            if (percentage >= 85) return { grade: 'B+', point: 8 };
            if (percentage >= 60) return { grade: 'B', point: 7 };
            if (percentage >= 50) return { grade: 'C+', point: 6 };
            if (percentage >= 40) return { grade: 'C', point: 5 };
            if (percentage >= 35) return { grade: 'D', point: 4 };
            return { grade: 'E/F', point: 0 };
        }

        // Toast Notification System
        function showToast(type, title, message) {
            const container = document.getElementById('toast-container');
            const toast = document.createElement('div');
            toast.className = `toast ${type}`;
            
            const iconSVG = type === 'success' 
                ? `<svg class="toast-icon" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2">
                     <path stroke-linecap="round" stroke-linejoin="round" d="M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z"></path>
                   </svg>`
                : type === 'error'
                ? `<svg class="toast-icon" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2">
                     <path stroke-linecap="round" stroke-linejoin="round" d="M10 14l2-2m0 0l2-2m-2 2l-2-2m2 2l2 2m7-2a9 9 0 11-18 0 9 9 0 0118 0z"></path>
                   </svg>`
                : `<svg class="toast-icon" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2">
                     <path stroke-linecap="round" stroke-linejoin="round" d="M12 9v2m0 4h.01m-6.938 4h13.856c1.54 0 2.502-1.667 1.732-3L13.732 4c-.77-1.333-2.694-1.333-3.464 0L3.34 16c-.77 1.333.192 3 1.732 3z"></path>
                   </svg>`;
            
            toast.innerHTML = `
                ${iconSVG}
                <div class="toast-content">
                    <div class="toast-title">${title}</div>
                    <div class="toast-message">${message}</div>
                </div>
                <button class="toast-close" onclick="this.parentElement.remove()">
                    <svg width="20" height="20" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2">
                        <path stroke-linecap="round" stroke-linejoin="round" d="M6 18L18 6M6 6l12 12"></path>
                    </svg>
                </button>
            `;
            
            container.appendChild(toast);
            
            // Auto remove after 5 seconds
            setTimeout(() => {
                toast.classList.add('removing');
                setTimeout(() => toast.remove(), 300);
            }, 5000);
        }

        function renderSubjects() {
            const container = document.getElementById('subjects-container');
            
            container.innerHTML = subjects.map((subject, idx) => `
                <div class="subject-card" id="subject-${idx}" data-subject-idx="${idx}">
                    <div class="subject-header">
                        <div>
                            <div class="subject-name">${subject.name}</div>
                            <div class="subject-meta">
                                <span>${subject.code}</span>
                                <span></span>
                                <span>${subject.credits} Credits</span>
                            </div>
                        </div>
                        <span class="badge">${subject.credits} CR</span>
                    </div>

                    <div class="components-grid">
                        ${subject.components.map((comp, compIdx) => {
                            // Handle grade input (GP-1 and Social Internship)
                            if (comp.isGradeInput) {
                                return `
                                    <div class="component-row">
                                        <div class="component-name">${comp.name}</div>
                                        <div class="si-dropdown-wrapper">
                                            <input type="checkbox" id="si-dropdown-touch-${idx}-${compIdx}">
                                            <label for="si-dropdown-touch-${idx}-${compIdx}" class="si-dropdown-label">
                                                <span id="si-selected-text-${idx}-${compIdx}">Select Grade</span>
                                            </label>
                                            <ul class="si-dropdown-slide">
                                                <li><a href="#" onclick="selectGrade(${idx}, ${compIdx}, 10, 'A+ (96-100)'); return false;">A+ (96-100)</a></li>
                                                <li><a href="#" onclick="selectGrade(${idx}, ${compIdx}, 9, 'A (90-95)'); return false;">A (90-95)</a></li>
                                                <li><a href="#" onclick="selectGrade(${idx}, ${compIdx}, 8, 'B+ (85-89)'); return false;">B+ (85-89)</a></li>
                                                <li><a href="#" onclick="selectGrade(${idx}, ${compIdx}, 7, 'B (60-84)'); return false;">B (60-84)</a></li>
                                                <li><a href="#" onclick="selectGrade(${idx}, ${compIdx}, 6, 'C+ (50-59)'); return false;">C+ (50-59)</a></li>
                                                <li><a href="#" onclick="selectGrade(${idx}, ${compIdx}, 5, 'C (40-49)'); return false;">C (40-49)</a></li>
                                                <li><a href="#" onclick="selectGrade(${idx}, ${compIdx}, 4, 'D (35-39)'); return false;">D (35-39)</a></li>
                                                <li><a href="#" onclick="selectGrade(${idx}, ${compIdx}, 0, 'E/F (0-34)'); return false;">E/F (0-34)</a></li>
                                            </ul>
                                            <input type="hidden" id="marks-${idx}-${compIdx}" value="" data-subject-idx="${idx}" data-comp-idx="${compIdx}" data-max="${comp.max}" data-is-grade-input="true">
                                        </div>
                                    </div>
                                `;
                            }
                            // Handle switch inputs (GP-1 or attendance)
                            else if (comp.isSwitch || comp.name.toLowerCase().includes('attendance')) {
                                return `
                                    <div class="component-row">
                                        <div class="component-name">${comp.name}</div>
                                        <div class="checkbox-wrapper-63">
                                            <label class="switch">
                                                <input 
                                                    type="checkbox" 
                                                    id="marks-${idx}-${compIdx}"
                                                    data-subject-idx="${idx}"
                                                    data-comp-idx="${compIdx}"
                                                    data-max="${comp.max}"
                                                    ${comp.isSwitch ? 'data-is-gp-switch="true"' : ''}
                                                    aria-label="${comp.name} - toggle for full marks"
                                                >
                                                <span class="slider"></span>
                                            </label>
                                        </div>
                                        <div class="component-max">${comp.isSwitch ? '' : '/ ' + comp.max}</div>
                                    </div>
                                `;
                            }
                            // Regular number inputs
                            else {
                                return `
                                    <div class="component-row">
                                        <div class="component-name">${comp.name}</div>
                                        <input 
                                            type="number" 
                                            id="marks-${idx}-${compIdx}"
                                            data-subject-idx="${idx}"
                                            data-comp-idx="${compIdx}"
                                            data-max="${comp.max}"
                                            min="0"
                                            step="0.5"
                                            placeholder="0"
                                            aria-label="${comp.name} marks out of ${comp.max}"
                                        >
                                        <div class="component-max">/ ${comp.max}</div>
                                    </div>
                                `;
                            }
                        }).join('')}
                    </div>

                    ${subject.externals && subject.externals.length > 0 ? `
                        <div class="external-section">
                            <div class="external-header">
                                <div class="external-title">
                                    <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" style="display: inline-block; vertical-align: middle; margin-right: 6px;">
                                        <path d="M14 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V8z"></path>
                                        <polyline points="14 2 14 8 20 8"></polyline>
                                        <line x1="16" y1="13" x2="8" y2="13"></line>
                                        <line x1="16" y1="17" x2="8" y2="17"></line>
                                        <polyline points="10 9 9 9 8 9"></polyline>
                                    </svg>
                                    External Exams (Estimate)
                                </div>
                                <div class="scenario-buttons">
                                    <button class="btn-scenario" onclick="applyScenario(${idx}, 'low')" aria-label="Apply low estimate">
                                        <span class="desktop-text">Low (50%)</span>
                                        <span class="mobile-text">Low</span>
                                    </button>
                                    <button class="btn-scenario" onclick="applyScenario(${idx}, 'mid')" aria-label="Apply mid estimate">
                                        <span class="desktop-text">Mid (70%)</span>
                                        <span class="mobile-text">Mid</span>
                                    </button>
                                    <button class="btn-scenario" onclick="applyScenario(${idx}, 'high')" aria-label="Apply high estimate">
                                        <span class="desktop-text">High (85%)</span>
                                        <span class="mobile-text">High</span>
                                    </button>
                                </div>
                            </div>
                            <div class="external-inputs">
                                ${subject.externals.map((ext, extIdx) => `
                                    <div class="component-row">
                                        <div class="component-name">${ext.name}</div>
                                        <input 
                                            type="number" 
                                            id="ext-${idx}-${extIdx}"
                                            data-subject-idx="${idx}"
                                            data-ext-idx="${extIdx}"
                                            data-max="${ext.max}"
                                            data-is-external="true"
                                            min="0"
                                            step="0.5"
                                            placeholder="Estimate (0-${ext.max})"
                                            aria-label="${ext.name} marks out of ${ext.max}"
                                        >
                                        <div class="component-max">/ ${ext.max}</div>
                                    </div>
                                `).join('')}
                            </div>
                        </div>
                    ` : ''}

                    <div class="subject-summary">
                        <table class="summary-table">
                            <thead>
                                <tr>
                                    ${subject.isGP || subject.isGradeInput ? `
                                        <th>Status</th>
                                    ` : `
                                        <th>Internal Total</th>
                                        ${subject.externals && subject.externals.length > 0 ? `
                                            <th>External Total</th>
                                            <th>Combined Total</th>
                                        ` : ''}
                                    `}
                                    <th>Grade</th>
                                </tr>
                            </thead>
                            <tbody>
                                <tr>
                                    ${subject.isGP ? `
                                        <td id="internal-${idx}">Not Done</td>
                                    ` : subject.isGradeInput ? `
                                        <td id="internal-${idx}">Not Selected</td>
                                    ` : `
                                        <td id="internal-${idx}">0 / ${subject.components.reduce((sum, c) => sum + c.max, 0)}</td>
                                        ${subject.externals && subject.externals.length > 0 ? `
                                            <td id="external-${idx}">0 / ${subject.externals.reduce((sum, e) => sum + e.max, 0)}</td>
                                            <td id="combined-${idx}">0 / ${subject.components.reduce((sum, c) => sum + c.max, 0) + subject.externals.reduce((sum, e) => sum + e.max, 0)}</td>
                                        ` : ''}
                                    `}
                                    <td class="grade-cell"><span class="grade-pill" id="grade-${idx}">-</span></td>
                                </tr>
                            </tbody>
                        </table>
                    </div>
                </div>
            `).join('');
            
            // Add backup event listeners for all input fields
            setTimeout(() => {
                subjects.forEach((subject, subjectIdx) => {
                    // Add listeners for internal components
                    subject.components.forEach((comp, compIdx) => {
                        const input = document.getElementById(`marks-${subjectIdx}-${compIdx}`);
                        if (input) {
                            if (input.type === 'checkbox') {
                                // Handle checkboxes with change event
                                input.addEventListener('change', function() {
                                    updateSubjectTotal(subjectIdx);
                                });
                            } else if (input.tagName === 'SELECT') {
                                // Handle select dropdowns (grade input)
                                input.addEventListener('change', function() {
                                    updateSubjectTotal(subjectIdx);
                                });
                            } else {
                                // Handle number inputs
                                input.addEventListener('input', function() {
                                    validateInput(this);
                                    updateSubjectTotal(subjectIdx);
                                });
                                input.addEventListener('keydown', function(event) {
                                    handleInputKeydown(event, subjectIdx, compIdx, comp.max, false);
                                });
                            }
                        }
                    });
                    
                    // Add listeners for external components
                    if (subject.externals) {
                        subject.externals.forEach((ext, extIdx) => {
                            const input = document.getElementById(`ext-${subjectIdx}-${extIdx}`);
                            if (input) {
                                input.addEventListener('input', function() {
                                    validateInput(this);
                                    updateSubjectTotal(subjectIdx);
                                });
                                input.addEventListener('keydown', function(event) {
                                    handleInputKeydown(event, subjectIdx, extIdx, ext.max, true);
                                });
                            }
                        });
                    }
                });
            }, 100);
            
            // Render subject navigation
            renderSubjectNav();
        }

        function selectGrade(subjectIdx, compIdx, gradePoint, gradeText) {
            // Update the hidden input value
            const hiddenInput = document.getElementById(`marks-${subjectIdx}-${compIdx}`);
            hiddenInput.value = gradePoint;
            
            // Update the displayed text
            const displayText = document.getElementById(`si-selected-text-${subjectIdx}-${compIdx}`);
            displayText.textContent = gradeText;
            
            // Close the dropdown
            const checkbox = document.getElementById(`si-dropdown-touch-${subjectIdx}-${compIdx}`);
            checkbox.checked = false;
            
            // Update the subject total
            updateSubjectTotal(subjectIdx);
        }

        function applyScenario(subjectIdx, scenario) {
            const subject = subjects[subjectIdx];
            if (!subject.externals) return;

            const percentages = {
                low: 0.50,
                mid: 0.70,
                high: 0.85
            };

            const percentage = percentages[scenario];
            
            subject.externals.forEach((ext, extIdx) => {
                const input = document.getElementById(`ext-${subjectIdx}-${extIdx}`);
                const estimatedMarks = Math.round(ext.max * percentage * 2) / 2;
                input.value = estimatedMarks;
            });

            updateSubjectTotal(subjectIdx);
        }

        function updateSubjectTotal(subjectIdx) {
            const subject = subjects[subjectIdx];
            const isGP1 = subject.code === "24GP-101";
            const isSocialInternship = subject.code === "24SI-101";
            
            // Handle GP-1 and Social Internship (both use grade input dropdowns)
            if (isGP1 || isSocialInternship) {
                const gradeElement = document.getElementById(`marks-${subjectIdx}-0`);
                const gradePoint = parseFloat(gradeElement.value) || 0;
                
                // Calculate percentage based on grade point
                let percentage = 0;
                if (gradePoint === 10) percentage = 98;
                else if (gradePoint === 9) percentage = 92.5;
                else if (gradePoint === 8) percentage = 87;
                else if (gradePoint === 7) percentage = 72;
                else if (gradePoint === 6) percentage = 54.5;
                else if (gradePoint === 5) percentage = 44.5;
                else if (gradePoint === 4) percentage = 37;
                else percentage = 0;
                
                const { grade, point } = getGrade(percentage);
                
                document.getElementById(`internal-${subjectIdx}`).textContent = 
                    grade || 'Not Selected';
                
                const gradeBadge = document.getElementById(`grade-${subjectIdx}`);
                if (window.innerWidth <= 768) {
                    gradeBadge.textContent = grade;
                } else {
                    gradeBadge.textContent = `${grade} (${point} GP)`;
                }
                gradeBadge.className = `grade-pill grade-${grade.toLowerCase().replace(/\//g, '-')}`;
                
                subject.percentage = percentage;
                subject.gradePoint = point;
                updateNavButtonStatus(subjectIdx);
                return;
            }
            
            // Detect subject type based on components
            const isHybrid = subject.code === "24CSH-202" || subject.code === "24CSH-204";
            const isPracticalOnly = subject.code === "24CSP-203";
            const isSoftSkills = subject.code === "24TDP-211" || subject.code === "24UCT-296";
            const isTheory = !isHybrid && !isPracticalOnly && !isSoftSkills && subject.externals && subject.externals[0].name.includes("External Theory");
            
            let internalObtained = 0;
            let internalMax = 0;
            let externalObtained = 0;
            let externalMax = 0;
            
            // Get raw input values - handle both checkboxes and number inputs
            const getVal = (compIdx) => {
                const element = document.getElementById(`marks-${subjectIdx}-${compIdx}`);
                if (element.type === 'checkbox') {
                    const maxValue = parseFloat(element.getAttribute('data-max'));
                    return element.checked ? maxValue : 0;
                }
                return parseFloat(element.value) || 0;
            };
            const getExt = (extIdx) => parseFloat(document.getElementById(`ext-${subjectIdx}-${extIdx}`).value) || 0;
            
            if (isHybrid) {
                // HYBRID SUBJECT CALCULATION (ADSA, DBMS)
                // Theory Part: Attendance(2) + MST1(20) + MST2(20) + Assignment(10) + Quiz(4) + Surprise(12) + Industry(10)
                const attendance = getVal(0);
                const mst1 = getVal(1);
                const mst2 = getVal(2);
                const exp1 = getVal(3);
                const exp2 = getVal(4);
                const exp3 = getVal(5);
                const exp4 = getVal(6);
                const classPerf = getVal(7);
                const assignment = getVal(8);
                const quiz = getVal(9);
                const surprise = getVal(10);
                const miniProject = getVal(11);
                const industry = getVal(12);
                
                // Theory Internal = Assignment(10) + AVG(MST1,MST2)(20) + (Surprise+Quiz)/2(8) + PBL(10) + Attendance(2) = 50
                const mstAvg = (mst1 + mst2) / 2; // Max 20
                const surpriseQuizAvg = (surprise + quiz) / 2; // Max 8
                const theoryInternal = assignment + mstAvg + surpriseQuizAvg + industry + attendance; // Max 50
                
                // Practical Internal = (SUM(4 Experiments)/3)(40) + ClassPerf/2(5) + MiniProject(5) + Industry(10) = 60
                const experimentsSum = exp1 + exp2 + exp3 + exp4;
                const experimentsScaled = experimentsSum / 3; // Max 40 (120/3)
                const classPerfScaled = classPerf / 2; // Max 5
                const practicalInternal = experimentsScaled + classPerfScaled + miniProject + industry; // Max 60
                
                internalObtained = theoryInternal + practicalInternal;
                internalMax = 110; // 50 theory + 60 practical
                
                // External: Theory(60 scaled to 50) + Practical(40)
                if (subject.externals) {
                    const extTheory = getExt(0);
                    const extPractical = getExt(1);
                    const extTheoryScaled = (extTheory / 60) * 50; // Scale 60 to 50
                    externalObtained = extTheoryScaled + extPractical;
                    externalMax = 90; // 50 + 40
                }
                
                // Combined and divided by 2 for display
                const totalObtained = (internalObtained + externalObtained) / 2;
                const totalMax = (internalMax + externalMax) / 2;
                const percentage = (totalObtained / totalMax) * 100;
                const { grade, point } = getGrade(percentage);
                
                document.getElementById(`internal-${subjectIdx}`).textContent = 
                    `${internalObtained.toFixed(1)} / ${internalMax}`;
                
                if (subject.externals) {
                    document.getElementById(`external-${subjectIdx}`).textContent = 
                        `${externalObtained.toFixed(1)} / ${externalMax}`;
                    document.getElementById(`combined-${subjectIdx}`).textContent = 
                        `${totalObtained.toFixed(1)} / ${totalMax}`;
                }
                
                const gradeElement = document.getElementById(`grade-${subjectIdx}`);
                // Show only grade on mobile, full format on desktop
                if (window.innerWidth <= 768) {
                    gradeElement.textContent = grade;
                } else {
                    gradeElement.textContent = `${grade} (${point} GP)`;
                }
                
                // Update navigation button to show completion status
                updateNavButtonStatus(subjectIdx);
                    
            } else if (isPracticalOnly) {
                // PRACTICAL ONLY SUBJECT (Python Programming)
                // No Attendance - starts with Class Performance
                const classPerf = getVal(0);
                const exp1 = getVal(1);
                const exp2 = getVal(2);
                const exp3 = getVal(3);
                const exp4 = getVal(4);
                const miniProject = getVal(5);
                const industry = getVal(6);
                
                // Internal = (AVG(4 experiments) * 40/30)(40) + ClassPerf/2(5) + MiniProject(5) + Industry(10) = 60
                const experimentsAvg = (exp1 + exp2 + exp3 + exp4) / 4; // Avg of 4 experiments (each max 30)
                const experimentsScaled = (experimentsAvg * 40) / 30; // Scale to 40
                const classPerfScaled = classPerf / 2; // Scale to 5
                internalObtained = experimentsScaled + classPerfScaled + miniProject + industry;
                internalMax = 60;
                
                // External: Viva(40)
                if (subject.externals) {
                    externalObtained = getExt(0);
                    externalMax = 40;
                }
                
                const totalObtained = internalObtained + externalObtained;
                const totalMax = internalMax + externalMax;
                const percentage = (totalObtained / totalMax) * 100;
                const { grade, point } = getGrade(percentage);
                
                document.getElementById(`internal-${subjectIdx}`).textContent = 
                    `${internalObtained.toFixed(1)} / ${internalMax}`;
                
                if (subject.externals) {
                    document.getElementById(`external-${subjectIdx}`).textContent = 
                        `${externalObtained.toFixed(1)} / ${externalMax}`;
                    document.getElementById(`combined-${subjectIdx}`).textContent = 
                        `${totalObtained.toFixed(1)} / ${totalMax}`;
                }
                
                const gradeElement = document.getElementById(`grade-${subjectIdx}`);
                // Show only grade on mobile, full format on desktop
                if (window.innerWidth <= 768) {
                    gradeElement.textContent = grade;
                } else {
                    gradeElement.textContent = `${grade} (${point} GP)`;
                }
                
                // Update navigation button to show completion status
                updateNavButtonStatus(subjectIdx);
                    
            } else if (isTheory) {
                // THEORY ONLY SUBJECT (COA, Discrete Math)
                // Components: Attendance(2) + Assignment(10) + MST1(20) + Quiz(4) + Surprise(12) + MST2(20)
                const attendance = getVal(0);
                const assignment = getVal(1);
                const mst1 = getVal(2);
                const quiz = getVal(3);
                const surprise = getVal(4);
                const mst2 = getVal(5);
                
                // Internal = Assignment(10) + AVG(MST1,MST2)(20) + Surprise/2(6) + Quiz/2(2) + Attendance(2) = 40
                const mstAvg = (mst1 + mst2) / 2; // Max 20
                const surpriseScaled = surprise / 2; // Max 6
                const quizScaled = quiz / 2; // Max 2
                internalObtained = assignment + mstAvg + surpriseScaled + quizScaled + attendance;
                internalMax = 40;
                
                // External: Theory(60)
                if (subject.externals) {
                    externalObtained = getExt(0);
                    externalMax = 60;
                }
                
                const totalObtained = internalObtained + externalObtained;
                const totalMax = internalMax + externalMax;
                const percentage = (totalObtained / totalMax) * 100;
                const { grade, point } = getGrade(percentage);
                
                document.getElementById(`internal-${subjectIdx}`).textContent = 
                    `${internalObtained.toFixed(1)} / ${internalMax}`;
                
                if (subject.externals) {
                    document.getElementById(`external-${subjectIdx}`).textContent = 
                        `${externalObtained.toFixed(1)} / ${externalMax}`;
                    document.getElementById(`combined-${subjectIdx}`).textContent = 
                        `${totalObtained.toFixed(1)} / ${totalMax}`;
                }
                
                const gradeElement = document.getElementById(`grade-${subjectIdx}`);
                // Show only grade on mobile, full format on desktop
                if (window.innerWidth <= 768) {
                    gradeElement.textContent = grade;
                } else {
                    gradeElement.textContent = `${grade} (${point} GP)`;
                }
                
                // Update navigation button to show completion status
                updateNavButtonStatus(subjectIdx);
                    
            } else {
                // SOFT SKILLS & UHV (Simple Addition)
                subject.components.forEach((comp, compIdx) => {
                    internalObtained += getVal(compIdx);
                    internalMax += comp.max;
                });
                
                if (subject.externals) {
                    subject.externals.forEach((ext, extIdx) => {
                        externalObtained += getExt(extIdx);
                        externalMax += ext.max;
                    });
                }
                
                const totalObtained = internalObtained + externalObtained;
                const totalMax = internalMax + externalMax;
                const percentage = (totalObtained / totalMax) * 100;
                const { grade, point } = getGrade(percentage);
                
                document.getElementById(`internal-${subjectIdx}`).textContent = 
                    `${internalObtained.toFixed(1)} / ${internalMax}`;
                
                if (subject.externals) {
                    document.getElementById(`external-${subjectIdx}`).textContent = 
                        `${externalObtained.toFixed(1)} / ${externalMax}`;
                    document.getElementById(`combined-${subjectIdx}`).textContent = 
                        `${totalObtained.toFixed(1)} / ${totalMax}`;
                }
                
                const gradeElement = document.getElementById(`grade-${subjectIdx}`);
                // Show only grade on mobile, full format on desktop
                if (window.innerWidth <= 768) {
                    gradeElement.textContent = grade;
                } else {
                    gradeElement.textContent = `${grade} (${point} GP)`;
                }
                
                // Update navigation button to show completion status
                updateNavButtonStatus(subjectIdx);
            }
        }

        function updateNavButtonStatus(subjectIdx) {
            // Update both desktop and mobile nav buttons
            const navBtns = document.querySelectorAll(`.subject-nav-btn[data-subject-idx="${subjectIdx}"]`);
            
            const subject = subjects[subjectIdx];
            const isGP1 = subject.code === "24GP-101";
            const isSocialInternship = subject.code === "24SI-101";
            
            // Special handling for GP-1 and Social Internship
            if (isGP1 || isSocialInternship) {
                const isComplete = parseFloat(document.getElementById(`marks-${subjectIdx}-0`)?.value) > 0;
                
                const bigTickIcon = `<svg class="nav-big-tick" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="3" stroke-linecap="round" stroke-linejoin="round"><polyline points="20 6 9 17 4 12"></polyline></svg>`;
                
                navBtns.forEach((navBtn) => {
                    const smallTick = navBtn.querySelector('.nav-tick');
                    const bigTick = navBtn.querySelector('.nav-big-tick');
                    const numberSpan = navBtn.querySelector('.nav-number');
                    if (smallTick) smallTick.remove();
                    if (bigTick) bigTick.remove();
                    
                    if (isComplete) {
                        // Show big tick for completion
                        navBtn.classList.add('complete', 'full-complete');
                        if (numberSpan) numberSpan.style.display = 'none';
                        navBtn.insertAdjacentHTML('beforeend', bigTickIcon);
                    } else {
                        // No completion
                        navBtn.classList.remove('complete', 'full-complete');
                        if (numberSpan) numberSpan.style.display = '';
                    }
                });
                return;
            }
            
            const isInternalComplete = isSubjectInternalComplete(subjectIdx);
            const isExternalComplete = isSubjectExternalComplete(subjectIdx);
            
            const smallTickIcon = `<svg class="nav-tick" width="12" height="12" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="3" stroke-linecap="round" stroke-linejoin="round"><polyline points="20 6 9 17 4 12"></polyline></svg>`;
            const bigTickIcon = `<svg class="nav-big-tick" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="3" stroke-linecap="round" stroke-linejoin="round"><polyline points="20 6 9 17 4 12"></polyline></svg>`;
            
            navBtns.forEach((navBtn) => {
                // Remove existing ticks
                const smallTick = navBtn.querySelector('.nav-tick');
                const bigTick = navBtn.querySelector('.nav-big-tick');
                const numberSpan = navBtn.querySelector('.nav-number');
                if (smallTick) smallTick.remove();
                if (bigTick) bigTick.remove();
                
                if (isInternalComplete && isExternalComplete) {
                    // Full completion: big tick replacing number
                    navBtn.classList.add('complete', 'full-complete');
                    if (numberSpan) numberSpan.style.display = 'none';
                    navBtn.insertAdjacentHTML('beforeend', bigTickIcon);
                } else if (isInternalComplete) {
                    // Partial completion: small tick on right
                    navBtn.classList.add('complete');
                    navBtn.classList.remove('full-complete');
                    if (numberSpan) numberSpan.style.display = '';
                    navBtn.insertAdjacentHTML('beforeend', smallTickIcon);
                } else {
                    // No completion: remove everything
                    navBtn.classList.remove('complete', 'full-complete');
                    if (numberSpan) numberSpan.style.display = '';
                }
            });
        }
        
        function isSubjectExternalComplete(subjectIdx) {
            const subject = subjects[subjectIdx];
            const externals = subject.externals || [];
            
            // If there are no external components, return false
            if (externals.length === 0) {
                return false;
            }
            
            // Check all external mark inputs (using correct ID format: ext-{subjectIdx}-{extIdx})
            for (let i = 0; i < externals.length; i++) {
                const externalInput = document.getElementById(`ext-${subjectIdx}-${i}`);
                if (!externalInput || externalInput.value === '' || externalInput.value === null) {
                    return false;
                }
            }
            
            return true;
        }

        function calculateSGPA() {
            // Validation: Check if any marks are entered
            let hasAnyInput = false;
            let hasMissingInternal = false;
            
            subjects.forEach((subject, idx) => {
                const isGP1 = subject.code === "24GP-101";
                const isSocialInternship = subject.code === "24SI-101";
                
                // Skip validation for GP-1 and Social Internship - they're optional/special
                if (isGP1 || isSocialInternship) {
                    const element = document.getElementById(`marks-${idx}-0`);
                    if (element && parseFloat(element.value) > 0) {
                        hasAnyInput = true;
                    }
                    return; // Skip further validation for these subjects
                }
                
                // Check internal marks
                subject.components.forEach((comp, compIdx) => {
                    const element = document.getElementById(`marks-${idx}-${compIdx}`);
                    if (element.type === 'checkbox') {
                        // Checkboxes are optional (attendance can be 0)
                        if (element.checked) hasAnyInput = true;
                    } else {
                        const value = element.value.trim();
                        if (value !== '') {
                            hasAnyInput = true;
                        } else {
                            hasMissingInternal = true;
                        }
                    }
                });
                
                // External marks are optional - no validation needed
            });
            
            // Show error if no marks entered at all
            if (!hasAnyInput) {
                showToast('error', 'No Marks Entered', 'Please enter at least some marks before calculating SGPA.');
                return;
            }
            
            // Show warning if internal marks are missing
            if (hasMissingInternal) {
                showToast('warning', 'Incomplete Data', 'Some internal marks are missing. Please fill all internal fields.');
                return;
            }
            
            let totalCredits = 0;
            let totalGradePoints = 0;
            let totalMarks = 0;
            const breakdown = [];

            subjects.forEach((subject, idx) => {
                const isGP1 = subject.code === "24GP-101";
                const isSocialInternship = subject.code === "24SI-101";
                
                // Handle GP-1 and Social Internship separately
                if (isGP1 || isSocialInternship) {
                    if (subject.percentage !== undefined && subject.gradePoint !== undefined) {
                        totalCredits += subject.credits;
                        totalGradePoints += (subject.credits * subject.gradePoint);
                        
                        breakdown.push({
                            name: subject.name,
                            code: subject.code,
                            credits: subject.credits,
                            percentage: subject.percentage,
                            grade: getGrade(subject.percentage).grade,
                            gradePoint: subject.gradePoint
                        });
                    }
                    return;
                }
                
                const isHybrid = subject.code === "24CSH-202" || subject.code === "24CSH-204";
                const isPracticalOnly = subject.code === "24CSP-203";
                const isSoftSkills = subject.code === "24TDP-211" || subject.code === "24UCT-296";
                const isTheory = !isHybrid && !isPracticalOnly && !isSoftSkills && subject.externals && subject.externals[0].name.includes("External Theory");
                
                const getVal = (compIdx) => {
                    const element = document.getElementById(`marks-${idx}-${compIdx}`);
                    if (element.type === 'checkbox') {
                        const maxValue = parseFloat(element.getAttribute('data-max'));
                        return element.checked ? maxValue : 0;
                    }
                    if (element.tagName === 'SELECT') {
                        const gradePoint = parseFloat(element.value) || 0;
                        if (gradePoint === 10) return 98;
                        if (gradePoint === 9) return 92.5;
                        if (gradePoint === 8) return 87;
                        if (gradePoint === 7) return 72;
                        if (gradePoint === 6) return 54.5;
                        if (gradePoint === 5) return 44.5;
                        if (gradePoint === 4) return 37;
                        return 0;
                    }
                    return parseFloat(element.value) || 0;
                };
                const getExt = (extIdx) => parseFloat(document.getElementById(`ext-${idx}-${extIdx}`).value) || 0;
                
                let internalObtained = 0;
                let externalObtained = 0;
                let totalObtained = 0;
                let totalMax = 0;
                
                if (isHybrid) {
                    // Hybrid calculation
                    const attendance = getVal(0);
                    const mst1 = getVal(1);
                    const mst2 = getVal(2);
                    const exp1 = getVal(3);
                    const exp2 = getVal(4);
                    const exp3 = getVal(5);
                    const exp4 = getVal(6);
                    const classPerf = getVal(7);
                    const assignment = getVal(8);
                    const quiz = getVal(9);
                    const surprise = getVal(10);
                    const miniProject = getVal(11);
                    const industry = getVal(12);
                    
                    const mstAvg = (mst1 + mst2) / 2;
                    const surpriseQuizAvg = (surprise + quiz) / 2;
                    const theoryInternal = assignment + mstAvg + surpriseQuizAvg + industry + attendance;
                    
                    const experimentsSum = exp1 + exp2 + exp3 + exp4;
                    const experimentsScaled = experimentsSum / 3;
                    const classPerfScaled = classPerf / 2;
                    const practicalInternal = experimentsScaled + classPerfScaled + miniProject + industry;
                    
                    internalObtained = theoryInternal + practicalInternal;
                    
                    if (subject.externals) {
                        const extTheory = getExt(0);
                        const extPractical = getExt(1);
                        const extTheoryScaled = (extTheory / 60) * 50;
                        externalObtained = extTheoryScaled + extPractical;
                    }
                    
                    totalObtained = (internalObtained + externalObtained) / 2;
                    totalMax = (110 + 90) / 2; // (Internal 110 + External 90) / 2 = 100
                    
                } else if (isPracticalOnly) {
                    // Practical only calculation
                    const classPerf = getVal(0);
                    const exp1 = getVal(1);
                    const exp2 = getVal(2);
                    const exp3 = getVal(3);
                    const exp4 = getVal(4);
                    const miniProject = getVal(5);
                    const industry = getVal(6);
                    
                    const experimentsAvg = (exp1 + exp2 + exp3 + exp4) / 4;
                    const experimentsScaled = (experimentsAvg * 40) / 30;
                    const classPerfScaled = classPerf / 2;
                    internalObtained = experimentsScaled + classPerfScaled + miniProject + industry;
                    
                    if (subject.externals) {
                        externalObtained = getExt(0);
                    }
                    
                    totalObtained = internalObtained + externalObtained;
                    totalMax = 100; // 60 internal + 40 external
                    
                } else if (isTheory) {
                    // Theory only calculation
                    const attendance = getVal(0);
                    const assignment = getVal(1);
                    const mst1 = getVal(2);
                    const quiz = getVal(3);
                    const surprise = getVal(4);
                    const mst2 = getVal(5);
                    
                    const mstAvg = (mst1 + mst2) / 2;
                    const surpriseScaled = surprise / 2;
                    const quizScaled = quiz / 2;
                    internalObtained = assignment + mstAvg + surpriseScaled + quizScaled + attendance;
                    
                    if (subject.externals) {
                        externalObtained = getExt(0);
                    }
                    
                    totalObtained = internalObtained + externalObtained;
                    totalMax = 100; // 40 internal + 60 external
                    
                } else {
                    // Soft Skills & UHV (simple addition)
                    subject.components.forEach((comp, compIdx) => {
                        internalObtained += getVal(compIdx);
                    });
                    
                    if (subject.externals) {
                        subject.externals.forEach((ext, extIdx) => {
                            externalObtained += getExt(extIdx);
                        });
                    }
                    
                    totalObtained = internalObtained + externalObtained;
                    const internalMax = subject.components.reduce((sum, c) => sum + c.max, 0);
                    const externalMax = subject.externals ? subject.externals.reduce((sum, e) => sum + e.max, 0) : 0;
                    totalMax = internalMax + externalMax;
                }
                
                const percentage = (totalObtained / totalMax) * 100;
                const { grade, point } = getGrade(percentage);

                totalCredits += subject.credits;
                totalGradePoints += point * subject.credits;
                totalMarks += totalObtained;

                breakdown.push({
                    name: subject.name,
                    code: subject.code,
                    grade: grade,
                    point: point,
                    credits: subject.credits,
                    contribution: point * subject.credits
                });
            });

            const sgpa = totalGradePoints / totalCredits;
            const sgpaGrade = getGrade((sgpa / 10) * 100);

            document.getElementById('sgpa-value').textContent = sgpa.toFixed(2);
            document.getElementById('total-credits').textContent = totalCredits;
            document.getElementById('total-marks').textContent = totalMarks.toFixed(1);

            // Show overall grade badge
            const gradeBadge = document.getElementById('sgpa-grade-badge');
            const overallGrade = document.getElementById('overall-grade');
            overallGrade.textContent = `${sgpaGrade.grade} Grade (${sgpaGrade.point} GP)`;
            gradeBadge.style.display = 'inline-flex';

            document.getElementById('sgpa-announcement').textContent = 
                `SGPA updated: ${sgpa.toFixed(2)}`;

            const breakdownList = document.getElementById('breakdown-list');
            breakdownList.innerHTML = breakdown.map((item, idx) => `
                <li class="breakdown-item">
                    <div class="breakdown-icon">${idx + 1}</div>
                    <div class="breakdown-info">
                        <div class="breakdown-course">${item.name}</div>
                        <div class="breakdown-code">${item.code}</div>
                    </div>
                    <div class="breakdown-stats">
                        <div class="breakdown-grade">${item.grade}  ${item.point} GP</div>
                        <div class="breakdown-calc">${item.credits} CR  ${item.point} GP = ${item.contribution}</div>
                    </div>
                </li>
            `).join('');

            // Show the Results tab
            const resultsTab = document.getElementById('tab-results');
            resultsTab.classList.add('show-tab');
            
            activateTab(document.getElementById('tab-results'));
            
            // Scroll to results section smoothly
            setTimeout(() => {
                const resultsPanel = document.getElementById('panel-results');
                if (resultsPanel) {
                    resultsPanel.scrollIntoView({ behavior: 'smooth', block: 'start' });
                }
            }, 100);
            
            // Trigger confetti based on SGPA
            setTimeout(() => {
                if (sgpa >= 8.0) {
                    // Full celebration confetti for 8.0 and above
                    const count = 200;
                    const defaults = {
                        origin: { y: 0.7 }
                    };

                    function fire(particleRatio, opts) {
                        confetti({
                            ...defaults,
                            ...opts,
                            particleCount: Math.floor(count * particleRatio)
                        });
                    }

                    fire(0.25, {
                        spread: 26,
                        startVelocity: 55,
                    });

                    fire(0.2, {
                        spread: 60,
                    });

                    fire(0.35, {
                        spread: 100,
                        decay: 0.91,
                        scalar: 0.8
                    });

                    fire(0.1, {
                        spread: 120,
                        startVelocity: 25,
                        decay: 0.92,
                        scalar: 1.2
                    });

                    fire(0.1, {
                        spread: 120,
                        startVelocity: 45,
                    });
                } else if (sgpa >= 7.5) {
                    // Thumbs up emoji confetti for 7.5 to 7.99
                    const scalar = 2;
                    const thumbsUp = confetti.shapeFromText({ text: '', scalar });

                    const defaults = {
                        spread: 360,
                        ticks: 60,
                        gravity: 0,
                        decay: 0.96,
                        startVelocity: 20,
                        shapes: [thumbsUp],
                        scalar
                    };

                    function shoot() {
                        confetti({
                            ...defaults,
                            particleCount: 30
                        });

                        confetti({
                            ...defaults,
                            particleCount: 5,
                            flat: true
                        });
                    }

                    setTimeout(shoot, 0);
                    setTimeout(shoot, 100);
                    setTimeout(shoot, 200);
                }
                // No confetti for SGPA < 7.5
            }, 500);
            
            // Show success toast
            showToast('success', 'SGPA Calculated!', `Your estimated SGPA is ${sgpa.toFixed(2)} with grade ${sgpaGrade.grade}`);
        }

        function downloadDetailedCSV() {
            // Detailed Marks format: Course Code, Course Name, Credits, Component, Max Marks, Obtained Marks
            const detailedRows = [['Course Code', 'Course Name', 'Credits', 'Component', 'Max Marks', 'Obtained Marks']];
            
            const getVal = (idx, compIdx) => {
                const element = document.getElementById(`marks-${idx}-${compIdx}`);
                if (!element) return 0;
                if (element.type === 'checkbox') {
                    return element.checked ? (parseFloat(element.dataset.max) || 0) : 0;
                }
                if (element.tagName === 'SELECT') {
                    const gradePoint = parseFloat(element.value) || 0;
                    if (gradePoint === 10) return 98;
                    if (gradePoint === 9) return 92.5;
                    if (gradePoint === 8) return 87;
                    if (gradePoint === 7) return 72;
                    if (gradePoint === 6) return 54.5;
                    if (gradePoint === 5) return 44.5;
                    if (gradePoint === 4) return 37;
                    return 0;
                }
                return parseFloat(element.value) || 0;
            };

            const getExt = (idx, extIdx) => {
                const element = document.getElementById(`ext-${idx}-${extIdx}`);
                return element ? (parseFloat(element.value) || 0) : 0;
            };

            subjects.forEach((subject, idx) => {
                // Add all internal components
                subject.components.forEach((comp, compIdx) => {
                    const obtainedMarks = getVal(idx, compIdx);
                    detailedRows.push([
                        subject.code,
                        subject.name,
                        subject.credits,
                        comp.name,
                        comp.max,
                        obtainedMarks || ''
                    ]);
                });

                // Add all external components
                if (subject.externals) {
                    subject.externals.forEach((ext, extIdx) => {
                        const obtainedMarks = getExt(idx, extIdx);
                        detailedRows.push([
                            subject.code,
                            subject.name,
                            subject.credits,
                            ext.name,
                            ext.max,
                            obtainedMarks || ''
                        ]);
                    });
                }
            });

            // Create CSV content for detailed marks
            const detailedContent = detailedRows.map(row => 
                row.map(cell => `"${String(cell).replace(/"/g, '""')}"`).join(',')
            ).join('\n');

            // Download detailed marks CSV
            const detailedBlob = new Blob([detailedContent], { type: 'text/csv' });
            const detailedUrl = URL.createObjectURL(detailedBlob);
            const detailedLink = document.createElement('a');
            detailedLink.href = detailedUrl;
            detailedLink.download = 'sgpa_marks_detailed.csv';
            detailedLink.click();
            URL.revokeObjectURL(detailedUrl);
            
            showToast('success', 'Detailed Marks Exported!', 'Downloaded: sgpa_marks_detailed.csv');
        }

        function downloadSummaryCSV() {
            // Summary format: Course Code, Course Name, Credits, Internal, External, Total, Grade, GP
            const summaryRows = [['Course Code', 'Course Name', 'Credits', 'Internal', 'External', 'Total', 'Grade', 'GP']];
            
            const getVal = (idx, compIdx) => {
                const element = document.getElementById(`marks-${idx}-${compIdx}`);
                if (!element) return 0;
                if (element.type === 'checkbox') {
                    return element.checked ? (parseFloat(element.dataset.max) || 0) : 0;
                }
                if (element.tagName === 'SELECT') {
                    const gradePoint = parseFloat(element.value) || 0;
                    if (gradePoint === 10) return 98;
                    if (gradePoint === 9) return 92.5;
                    if (gradePoint === 8) return 87;
                    if (gradePoint === 7) return 72;
                    if (gradePoint === 6) return 54.5;
                    if (gradePoint === 5) return 44.5;
                    if (gradePoint === 4) return 37;
                    return 0;
                }
                return parseFloat(element.value) || 0;
            };

            const getExt = (idx, extIdx) => {
                const element = document.getElementById(`ext-${idx}-${extIdx}`);
                return element ? (parseFloat(element.value) || 0) : 0;
            };

            let totalCredits = 0;
            let totalMarks = 0;
            let totalGradePoints = 0;
            let totalWeightedGP = 0;

            subjects.forEach((subject, idx) => {
                let internalObtained = 0, internalMax = 0;
                let externalObtained = 0, externalMax = 0;

                // Calculate internal marks from all internal components
                subject.components.forEach((comp, compIdx) => {
                    const obtained = getVal(idx, compIdx);
                    internalObtained += obtained;
                    internalMax += comp.max;
                });

                // Calculate external marks from all external components
                if (subject.externals) {
                    subject.externals.forEach((ext, extIdx) => {
                        const obtained = getExt(idx, extIdx);
                        externalObtained += obtained;
                        externalMax += ext.max;
                    });
                }

                const totalObtained = internalObtained + externalObtained;
                const totalMax = internalMax + externalMax;
                const percentage = totalMax > 0 ? (totalObtained / totalMax) * 100 : 0;
                const { grade, point } = getGrade(percentage);

                // Accumulate totals
                totalCredits += subject.credits;
                totalMarks += totalObtained;
                totalGradePoints += point;
                totalWeightedGP += (subject.credits * point);

                summaryRows.push([
                    subject.code,
                    subject.name,
                    subject.credits,
                    `${internalObtained.toFixed(1)}/${internalMax}`,
                    `${externalObtained.toFixed(1)}/${externalMax}`,
                    `${totalObtained.toFixed(1)}/${totalMax}`,
                    grade,
                    point
                ]);
            });

            // Calculate SGPA
            const sgpa = totalCredits > 0 ? totalWeightedGP / totalCredits : 0;
            const sgpaGrade = getGrade((sgpa / 10) * 100);

            // Add SGPA summary section
            summaryRows.push([]);  // Empty row
            summaryRows.push(['SGPA SUMMARY']);
            summaryRows.push(['Your Estimated SGPA', sgpa.toFixed(2)]);
            summaryRows.push(['Grade', `${sgpaGrade.grade} Grade (${sgpaGrade.point} GP)`]);
            summaryRows.push(['Total Credits', totalCredits]);
            summaryRows.push(['Total Marks you earned', totalMarks.toFixed(1)]);
            summaryRows.push([]);  // Empty row
            summaryRows.push(['Subject-wise Breakdown']);

            // Add subject-wise breakdown
            subjects.forEach((subject, idx) => {
                let internalObtained = 0, internalMax = 0;
                let externalObtained = 0, externalMax = 0;

                subject.components.forEach((comp, compIdx) => {
                    const obtained = getVal(idx, compIdx);
                    internalObtained += obtained;
                    internalMax += comp.max;
                });

                if (subject.externals) {
                    subject.externals.forEach((ext, extIdx) => {
                        const obtained = getExt(idx, extIdx);
                        externalObtained += obtained;
                        externalMax += ext.max;
                    });
                }

                const totalObtained = internalObtained + externalObtained;
                const totalMax = internalMax + externalMax;
                const percentage = totalMax > 0 ? (totalObtained / totalMax) * 100 : 0;
                const { grade, point } = getGrade(percentage);

                summaryRows.push([
                    (idx + 1),
                    subject.name,
                    subject.code,
                    `${grade}  ${point} GP`,
                    `${subject.credits} CR  ${point} GP = ${subject.credits * point}`
                ]);
            });

            // Create CSV content for summary
            const summaryContent = summaryRows.map(row => 
                row.map(cell => `"${String(cell).replace(/"/g, '""')}"`).join(',')
            ).join('\n');

            // Download summary CSV
            const summaryBlob = new Blob([summaryContent], { type: 'text/csv' });
            const summaryUrl = URL.createObjectURL(summaryBlob);
            const summaryLink = document.createElement('a');
            summaryLink.href = summaryUrl;
            summaryLink.download = 'sgpa_summary.csv';
            summaryLink.click();
            URL.revokeObjectURL(summaryUrl);
            
            showToast('success', 'Summary Exported!', 'Downloaded: sgpa_summary.csv');
        }

        async function downloadExcel() {
            try {
                // Load SheetJS library if not already loaded
                if (typeof XLSX === 'undefined') {
                    const script = document.createElement('script');
                    script.src = 'https://cdn.sheetjs.com/xlsx-0.20.1/package/dist/xlsx.full.min.js';
                    document.head.appendChild(script);
                    await new Promise((resolve, reject) => {
                        script.onload = resolve;
                        script.onerror = reject;
                    });
                }

                const getVal = (idx, compIdx) => {
                    const element = document.getElementById(`marks-${idx}-${compIdx}`);
                    if (!element) return 0;
                    if (element.type === 'checkbox') {
                        return element.checked ? (parseFloat(element.dataset.max) || 0) : 0;
                    }
                    if (element.tagName === 'SELECT') {
                        // For grade input, convert grade point to percentage-based value
                        const gradePoint = parseFloat(element.value) || 0;
                        if (gradePoint === 10) return 98;
                        if (gradePoint === 9) return 92.5;
                        if (gradePoint === 8) return 87;
                        if (gradePoint === 7) return 72;
                        if (gradePoint === 6) return 54.5;
                        if (gradePoint === 5) return 44.5;
                        if (gradePoint === 4) return 37;
                        return 0;
                    }
                    return parseFloat(element.value) || 0;
                };

                const getExt = (idx, extIdx) => {
                    const element = document.getElementById(`ext-${idx}-${extIdx}`);
                    return element ? (parseFloat(element.value) || 0) : 0;
                };

                // Prepare Summary Sheet data (Sheet 1)
                const summaryHeaders = ['Course Code', 'Course Name', 'Credits', 'Internal', 'External', 'Total', 'Grade', 'GP'];
                const summaryData = [];

                let totalCredits = 0;
                let totalMarks = 0;
                let totalGradePoints = 0;
                let totalWeightedGP = 0;

                subjects.forEach((subject, idx) => {
                    let internalObtained = 0, internalMax = 0;
                    let externalObtained = 0, externalMax = 0;

                    // Calculate internal marks from all internal components
                    subject.components.forEach((comp, compIdx) => {
                        const obtained = getVal(idx, compIdx);
                        internalObtained += obtained;
                        internalMax += comp.max;
                    });

                    // Calculate external marks from all external components
                    if (subject.externals) {
                        subject.externals.forEach((ext, extIdx) => {
                            const obtained = getExt(idx, extIdx);
                            externalObtained += obtained;
                            externalMax += ext.max;
                        });
                    }

                    const totalObtained = internalObtained + externalObtained;
                    const totalMax = internalMax + externalMax;
                    const percentage = totalMax > 0 ? (totalObtained / totalMax) * 100 : 0;
                    const { grade, point } = getGrade(percentage);

                    // Accumulate totals
                    totalCredits += subject.credits;
                    totalMarks += totalObtained;
                    totalGradePoints += point;
                    totalWeightedGP += (subject.credits * point);

                    summaryData.push([
                        subject.code,
                        subject.name,
                        subject.credits,
                        `${internalObtained.toFixed(1)}/${internalMax}`,
                        `${externalObtained.toFixed(1)}/${externalMax}`,
                        `${totalObtained.toFixed(1)}/${totalMax}`,
                        grade,
                        point
                    ]);
                });

                // Calculate SGPA
                const sgpa = totalCredits > 0 ? totalWeightedGP / totalCredits : 0;
                const sgpaGrade = getGrade((sgpa / 10) * 100);

                // Add SGPA summary section
                summaryData.push([]);  // Empty row
                summaryData.push(['SGPA SUMMARY']);
                summaryData.push(['Your Estimated SGPA', sgpa.toFixed(2)]);
                summaryData.push([`${sgpaGrade.grade} Grade (${sgpaGrade.point} GP)`]);
                summaryData.push(['SGPA updated:', sgpa.toFixed(2)]);
                summaryData.push(['Total Credits', totalCredits]);
                summaryData.push(['Total Marks', totalMarks.toFixed(1)]);
                summaryData.push([]);  // Empty row
                summaryData.push(['Subject-wise Breakdown']);

                // Add subject-wise breakdown
                subjects.forEach((subject, idx) => {
                    let internalObtained = 0, internalMax = 0;
                    let externalObtained = 0, externalMax = 0;

                    subject.components.forEach((comp, compIdx) => {
                        const obtained = getVal(idx, compIdx);
                        internalObtained += obtained;
                        internalMax += comp.max;
                    });

                    if (subject.externals) {
                        subject.externals.forEach((ext, extIdx) => {
                            const obtained = getExt(idx, extIdx);
                            externalObtained += obtained;
                            externalMax += ext.max;
                        });
                    }

                    const totalObtained = internalObtained + externalObtained;
                    const totalMax = internalMax + externalMax;
                    const percentage = totalMax > 0 ? (totalObtained / totalMax) * 100 : 0;
                    const { grade, point } = getGrade(percentage);

                    summaryData.push([
                        (idx + 1),
                        subject.name,
                        subject.code,
                        `${grade}  ${point} GP`,
                        `${subject.credits} CR  ${point} GP = ${subject.credits * point}`
                    ]);
                });

                // Prepare Detailed Marks Sheet data (Sheet 2) - same as downloadDetailedCSV
                const detailedHeaders = ['Course Code', 'Course Name', 'Credits', 'Component', 'Max Marks', 'Obtained Marks'];
                const detailedData = [];

                subjects.forEach((subject, idx) => {
                    // Add all internal components
                    subject.components.forEach((comp, compIdx) => {
                        const obtainedMarks = getVal(idx, compIdx);
                        detailedData.push([
                            subject.code,
                            subject.name,
                            subject.credits,
                            comp.name,
                            comp.max,
                            obtainedMarks || ''
                        ]);
                    });

                    // Add all external components
                    if (subject.externals) {
                        subject.externals.forEach((ext, extIdx) => {
                            const obtainedMarks = getExt(idx, extIdx);
                            detailedData.push([
                                subject.code,
                                subject.name,
                                subject.credits,
                                ext.name,
                                ext.max,
                                obtainedMarks || ''
                            ]);
                        });
                    }
                });

                // Create workbook
                const wb = XLSX.utils.book_new();

                // Add Summary sheet first
                const ws1 = XLSX.utils.aoa_to_sheet([summaryHeaders, ...summaryData]);
                XLSX.utils.book_append_sheet(wb, ws1, "Summary");

                // Add Detailed Marks sheet second 
                const ws2 = XLSX.utils.aoa_to_sheet([detailedHeaders, ...detailedData]);
                XLSX.utils.book_append_sheet(wb, ws2, "Detailed Marks");

                // Download
                XLSX.writeFile(wb, 'sgpa_calculation.xlsx');

                showToast('success', 'Excel Exported!', 'Downloaded: sgpa_calculation.xlsx with 2 sheets');
            } catch (error) {
                console.error('Excel export error:', error);
                showToast('error', 'Export Failed', 'Could not generate Excel file');
            }
        }
        
        function downloadTemplateCSV() {
            const rows = [['Course Code', 'Course Name', 'Credits', 'Component', 'Max Marks', 'Obtained Marks']];
            
            subjects.forEach((subject) => {
                // Add internal components
                subject.components.forEach((comp) => {
                    rows.push([
                        subject.code,
                        subject.name,
                        subject.credits,
                        comp.name,
                        comp.max,
                        '' // Empty for user to fill
                    ]);
                });
                
                // Add external components
                if (subject.externals) {
                    subject.externals.forEach((ext) => {
                        rows.push([
                            subject.code,
                            subject.name,
                            subject.credits,
                            ext.name,
                            ext.max,
                            '' // Empty for user to fill
                        ]);
                    });
                }
            });

            const csvContent = rows.map(row => 
                row.map(cell => `"${String(cell).replace(/"/g, '""')}"`).join(',')
            ).join('\n');

            const blob = new Blob([csvContent], { type: 'text/csv' });
            const url = URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = 'sgpa_template.csv';
            a.click();
            URL.revokeObjectURL(url);
            
            showToast('success', 'Template Downloaded!', 'Fill in the obtained marks and import it back.');
        }
        
        function importCSV() {
            const input = document.createElement('input');
            input.type = 'file';
            input.accept = '.csv';
            
            input.onchange = (e) => {
                const file = e.target.files[0];
                if (!file) return;
                
                const reader = new FileReader();
                reader.onload = (event) => {
                    try {
                        const csvText = event.target.result;
                        const rows = csvText.split('\n').map(row => {
                            const matches = row.match(/("([^"]|"")*"|[^,]+)/g);
                            return matches ? matches.map(cell => cell.replace(/^"|"$/g, '').replace(/""/g, '"').trim()) : [];
                        });
                        
                        let importedCount = 0;
                        
                        // Skip header row
                        for (let i = 1; i < rows.length; i++) {
                            const [code, name, credits, component, maxMarks, obtainedMarks] = rows[i];
                            
                            if (!code || !component || obtainedMarks === undefined || obtainedMarks === '') continue;
                            
                            // Find subject by code
                            const subjectIdx = subjects.findIndex(s => s.code.trim() === code.trim());
                            if (subjectIdx === -1) {
                                console.log(`Subject not found for code: ${code}`);
                                continue;
                            }
                            
                            const subject = subjects[subjectIdx];
                            
                            // Try to find component (case-insensitive and flexible matching)
                            let compIdx = subject.components.findIndex(c => 
                                c.name.toLowerCase().trim() === component.toLowerCase().trim()
                            );
                            
                            // If exact match not found, try partial matching
                            if (compIdx === -1) {
                                compIdx = subject.components.findIndex(c => 
                                    c.name.toLowerCase().includes(component.toLowerCase().trim()) ||
                                    component.toLowerCase().includes(c.name.toLowerCase().trim())
                                );
                            }
                            
                            if (compIdx !== -1) {
                                const input = document.getElementById(`marks-${subjectIdx}-${compIdx}`);
                                if (input) {
                                    if (input.type === 'checkbox') {
                                        input.checked = parseFloat(obtainedMarks) > 0;
                                    } else {
                                        input.value = parseFloat(obtainedMarks) || 0;
                                    }
                                    importedCount++;
                                } else {
                                    console.log(`Input not found: marks-${subjectIdx}-${compIdx}`);
                                }
                            } else {
                                console.log(`Component not found: ${component} in subject ${subject.name}`);
                            }
                            
                            // Check if it's an external component
                            if (subject.externals) {
                                let extIdx = subject.externals.findIndex(e => 
                                    e.name.toLowerCase().trim() === component.toLowerCase().trim()
                                );
                                
                                // If exact match not found, try partial matching
                                if (extIdx === -1) {
                                    extIdx = subject.externals.findIndex(e => 
                                        e.name.toLowerCase().includes(component.toLowerCase().trim()) ||
                                        component.toLowerCase().includes(e.name.toLowerCase().trim())
                                    );
                                }
                                
                                if (extIdx !== -1) {
                                    const input = document.getElementById(`ext-${subjectIdx}-${extIdx}`);
                                    if (input) {
                                        input.value = parseFloat(obtainedMarks) || 0;
                                        importedCount++;
                                    } else {
                                        console.log(`External input not found: ext-${subjectIdx}-${extIdx}`);
                                    }
                                }
                            }
                        }
                        
                        // Update all totals
                        subjects.forEach((_, idx) => updateSubjectTotal(idx));
                        
                        if (importedCount > 0) {
                            showToast('success', 'CSV Imported!', `Successfully imported ${importedCount} value(s).`);
                        } else {
                            showToast('warning', 'Import Warning', 'No valid marks were found in the CSV file. Please check the format and component names.');
                        }
                    } catch (error) {
                        console.error('Import error:', error);
                        showToast('error', 'Import Failed', 'Unable to parse the CSV file. Please check the format.');
                    }
                };
                
                reader.readAsText(file);
            };
            
            input.click();
        }

        document.querySelectorAll('[role="tab"]').forEach(tab => {
            tab.addEventListener('click', () => activateTab(tab));
            tab.addEventListener('keydown', (e) => {
                const list = Array.from(tab.parentElement.parentElement.querySelectorAll('[role="tab"]'));
                let idx = list.indexOf(tab);
                
                if (e.key === 'ArrowRight') idx = (idx + 1) % list.length;
                if (e.key === 'ArrowLeft') idx = (idx - 1 + list.length) % list.length;
                if (e.key === 'Home') idx = 0;
                if (e.key === 'End') idx = list.length - 1;
                
                if (['ArrowRight', 'ArrowLeft', 'Home', 'End'].includes(e.key)) {
                    e.preventDefault();
                    list[idx].focus();
                    activateTab(list[idx]);
                }
            });
        });

        function activateTab(tab) {
            const tablist = tab.closest('[role="tablist"]');
            tablist.querySelectorAll('[role="tab"]').forEach(t => {
                t.setAttribute('aria-selected', t === tab ? 'true' : 'false');
                t.tabIndex = t === tab ? 0 : -1;
            });
            
            const panels = document.querySelectorAll('[role="tabpanel"]');
            panels.forEach(p => {
                p.hidden = p.id !== tab.getAttribute('aria-controls');
            });
            
            // Show/hide subject navigation based on active tab
            const subjectNavDesktop = document.getElementById('subject-nav');
            const subjectNavMobile = document.getElementById('subject-nav-mobile');
            const activePanel = tab.getAttribute('aria-controls');
            
            // Show/hide CSV action buttons based on active tab
            const csvButtons = document.querySelectorAll('.action-icon-btn:not(:last-child):not(#excel-download-btn)');
            const excelButton = document.getElementById('excel-download-btn');
            const isInputsTab = activePanel === 'panel-inputs';
            const isResultsTab = activePanel === 'panel-results';
            
            csvButtons.forEach(btn => {
                btn.style.display = isInputsTab ? 'flex' : 'none';
            });
            
            // Show Excel button only on Results tab
            if (excelButton) {
                excelButton.style.display = isResultsTab ? 'flex' : 'none';
            }
            
            if (activePanel === 'panel-inputs') {
                // Show subject nav on inputs tab
                subjectNavDesktop.style.display = 'flex';
                subjectNavMobile.style.display = 'flex';
                renderSubjectNav();
            } else if (activePanel === 'panel-help') {
                // Show help nav on help tab - desktop only
                subjectNavDesktop.style.display = 'flex';
                subjectNavMobile.style.display = 'none';
                renderHelpNav();
            } else {
                // Hide nav on results tab
                subjectNavDesktop.style.display = 'none';
                subjectNavMobile.style.display = 'none';
            }
        }

        function renderSubjectNav() {
            const navHTML = subjects.map((subject, idx) => {
                return `
                    <button 
                        class="subject-nav-btn" 
                        onclick="scrollToSubject(${idx})" 
                        title="${subject.name}" 
                        data-subject-idx="${idx}"
                        data-tooltip="${subject.name}">
                        <span class="nav-number">${idx + 1}</span>
                    </button>
                `;
            }).join('');
            
            // Render to both desktop and mobile containers
            const navContainerDesktop = document.getElementById('subject-nav');
            const navContainerMobile = document.getElementById('subject-nav-mobile');
            navContainerDesktop.innerHTML = navHTML;
            navContainerMobile.innerHTML = navHTML;
            
            // Update all nav button statuses after rendering
            subjects.forEach((_, idx) => {
                updateNavButtonStatus(idx);
                // Force an update for all subjects to ensure completion status is checked
                updateSubjectTotal(idx);
            });
            
            setupNavObserver();
        }

        function isSubjectInternalComplete(subjectIdx) {
            const subject = subjects[subjectIdx];
            let allFilled = true;
            let totalFields = 0;
            let filledFields = 0;
            
            subject.components.forEach((comp, compIdx) => {
                const element = document.getElementById(`marks-${subjectIdx}-${compIdx}`);
                if (element) {
                    if (element.type === 'checkbox') {
                        // Checkboxes are optional, so we don't check them
                    } else {
                        totalFields++;
                        const value = element.value.trim();
                        if (value === '') {
                            allFilled = false;
                        } else {
                            filledFields++;
                        }
                    }
                }
            });
            
            return allFilled;
        }

        function renderHelpNav() {
            const helpTopics = [
                { 
                    id: 'help-sgpa', 
                    icon: `<svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5" stroke-linecap="round" stroke-linejoin="round"><line x1="18" y1="20" x2="18" y2="10"></line><line x1="12" y1="20" x2="12" y2="4"></line><line x1="6" y1="20" x2="6" y2="14"></line></svg>`, 
                    label: 'SGPA Calculation' 
                },
                { 
                    id: 'help-grades', 
                    icon: `<svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5" stroke-linecap="round" stroke-linejoin="round"><path d="M22 10v6M2 10l10-5 10 5-10 5z"></path><path d="M6 12v5c3 3 9 3 12 0v-5"></path></svg>`, 
                    label: 'Grade Scale' 
                },
                { 
                    id: 'help-scenarios', 
                    icon: `<svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5" stroke-linecap="round" stroke-linejoin="round"><polygon points="13 2 3 14 12 14 11 22 21 10 12 10 13 2"></polygon></svg>`, 
                    label: 'Scenarios' 
                }
            ];
            
            // Desktop navigation with tooltips
            const navHTMLDesktop = helpTopics.map((topic, idx) => `
                <button 
                    class="subject-nav-btn help-nav-btn" 
                    onclick="scrollToHelpSection('${topic.id}')" 
                    data-tooltip="${topic.label}">
                    ${topic.icon}
                </button>
            `).join('');
            
            // Mobile navigation - icons only, no tooltips
            const navHTMLMobile = helpTopics.map((topic, idx) => `
                <button 
                    class="subject-nav-btn help-nav-btn" 
                    onclick="scrollToHelpSection('${topic.id}')">
                    ${topic.icon}
                </button>
            `).join('');
            
            // Render to both containers
            const navContainerDesktop = document.getElementById('subject-nav');
            const navContainerMobile = document.getElementById('subject-nav-mobile');
            navContainerDesktop.innerHTML = navHTMLDesktop;
            navContainerMobile.innerHTML = navHTMLMobile;
            
            setupHelpNavObserver();
        }

        function scrollToHelpSection(sectionId) {
            const section = document.getElementById(sectionId);
            if (section) {
                section.scrollIntoView({ behavior: 'smooth', block: 'start' });
                
                // Manually update active state after scroll
                setTimeout(() => {
                    updateHelpNavActive(sectionId);
                }, 100);
            }
        }

        function updateHelpNavActive(activeSectionId) {
            const navButtons = document.querySelectorAll('.help-nav-btn');
            navButtons.forEach(btn => {
                const btnTarget = btn.getAttribute('onclick').match(/'([^']+)'/)[1];
                if (btnTarget === activeSectionId) {
                    btn.classList.add('active');
                } else {
                    btn.classList.remove('active');
                }
            });
        }

        function setupHelpNavObserver() {
            const navButtons = document.querySelectorAll('.help-nav-btn');
            const helpSections = document.querySelectorAll('.help-section');
            
            if (helpSections.length === 0) return;
            
            const observer = new IntersectionObserver((entries) => {
                // Find the section with highest intersection ratio
                let mostVisible = null;
                let maxRatio = 0;
                
                entries.forEach(entry => {
                    if (entry.intersectionRatio > maxRatio) {
                        maxRatio = entry.intersectionRatio;
                        mostVisible = entry.target;
                    }
                });
                
                if (mostVisible && maxRatio > 0.3) {
                    updateHelpNavActive(mostVisible.id);
                }
            }, { 
                threshold: [0, 0.25, 0.5, 0.75, 1],
                rootMargin: '-20% 0px -50% 0px'
            });
            
            helpSections.forEach(section => observer.observe(section));
        }

        // Theme toggle functionality
        async function toggleTheme(event) {
            const html = document.documentElement;
            const currentTheme = html.getAttribute('data-theme');
            const newTheme = currentTheme === 'dark' ? 'light' : 'dark';
            
            // Get the theme button position
            const button = event ? event.currentTarget : document.querySelector('.action-icon-btn:last-child');
            const rect = button.getBoundingClientRect();
            const x = rect.left + rect.width / 2;
            const y = rect.top + rect.height / 2;
            
            // Check if browser supports View Transitions API
            if (!document.startViewTransition) {
                // Fallback: simple theme change
                html.setAttribute('data-theme', newTheme);
                localStorage.setItem('theme', newTheme);
                updateThemeIcons(newTheme);
                return;
            }
            
            // Use View Transitions API for smooth animation
            const transition = document.startViewTransition(() => {
                html.setAttribute('data-theme', newTheme);
                localStorage.setItem('theme', newTheme);
                updateThemeIcons(newTheme);
            });
            
            // Wait for transition to be ready
            await transition.ready;
            
            // Calculate the maximum distance to cover entire screen from click point
            const maxDistanceX = Math.max(x, window.innerWidth - x);
            const maxDistanceY = Math.max(y, window.innerHeight - y);
            const radius = Math.sqrt(maxDistanceX ** 2 + maxDistanceY ** 2);
            
            // Animate with custom clip-path from button position
            document.documentElement.animate(
                {
                    clipPath: [
                        `circle(0px at ${x}px ${y}px)`,
                        `circle(${radius}px at ${x}px ${y}px)`
                    ]
                },
                {
                    duration: 800,
                    easing: 'cubic-bezier(0.4, 0, 0.2, 1)',
                    pseudoElement: '::view-transition-new(root)'
                }
            );
        }
        
        function updateThemeIcons(theme) {
            const lightIcon = document.getElementById('theme-icon-light');
            const darkIcon = document.getElementById('theme-icon-dark');
            
            if (theme === 'dark') {
                lightIcon.style.display = 'block';
                darkIcon.style.display = 'none';
            } else {
                lightIcon.style.display = 'none';
                darkIcon.style.display = 'block';
            }
        }

        // Load saved theme
        function loadTheme() {
            const savedTheme = localStorage.getItem('theme') || 'dark';
            document.documentElement.setAttribute('data-theme', savedTheme);
            
            const lightIcon = document.getElementById('theme-icon-light');
            const darkIcon = document.getElementById('theme-icon-dark');
            
            if (savedTheme === 'dark') {
                lightIcon.style.display = 'block';
                darkIcon.style.display = 'none';
            } else {
                lightIcon.style.display = 'none';
                darkIcon.style.display = 'block';
            }
        }

        // Validate input to not exceed max value
        function validateInput(input) {
            const max = parseFloat(input.getAttribute('data-max'));
            let value = parseFloat(input.value);
            
            // Allow any input but cap at max when provided
            if (!isNaN(value) && value > max) {
                input.value = max.toFixed(1);
                input.classList.add('error');
                setTimeout(() => input.classList.remove('error'), 500);
            } else if (!isNaN(value) && value < 0) {
                input.value = 0;
            }
        }

        // Handle keyboard navigation and increment/decrement
        function handleInputKeydown(event, subjectIdx, compIdx, max, isExternal) {
            const input = event.target;
            const currentValue = parseFloat(input.value) || 0;
            const step = max <= 10 ? 0.5 : 1; // Use 0.5 for small limits, 1 for bigger
            
            // Arrow Up: Increment
            if (event.key === 'ArrowUp') {
                event.preventDefault();
                const newValue = Math.min(currentValue + step, max);
                input.value = newValue;
                validateInput(input);
                updateSubjectTotal(subjectIdx);
            }
            
            // Arrow Down: Decrement
            if (event.key === 'ArrowDown') {
                event.preventDefault();
                const newValue = Math.max(currentValue - step, 0);
                input.value = newValue;
                validateInput(input);
                updateSubjectTotal(subjectIdx);
            }
            
            // Enter: Move to next input
            if (event.key === 'Enter') {
                event.preventDefault();
                const allInputs = Array.from(document.querySelectorAll('input[type="number"]'));
                const currentIndex = allInputs.indexOf(input);
                if (currentIndex < allInputs.length - 1) {
                    allInputs[currentIndex + 1].focus();
                    allInputs[currentIndex + 1].select();
                }
            }
        }

        // Scroll to subject
        function scrollToSubject(idx) {
            const element = document.getElementById(`subject-${idx}`);
            if (element) {
                const yOffset = -100; // Offset from top
                const y = element.getBoundingClientRect().top + window.pageYOffset + yOffset;
                window.scrollTo({ top: y, behavior: 'smooth' });
                
                // Update active state immediately
                document.querySelectorAll('.subject-nav-btn').forEach(btn => {
                    btn.classList.remove('active');
                });
                const activeBtn = document.querySelector(`.subject-nav-btn[data-subject-idx="${idx}"]`);
                if (activeBtn) {
                    activeBtn.classList.add('active');
                }
            }
        }

        // Setup intersection observer for active nav button
        function setupNavObserver() {
            const options = {
                root: null,
                rootMargin: '-20% 0px -60% 0px',
                threshold: [0, 0.1, 0.5, 1]
            };

            const observer = new IntersectionObserver((entries) => {
                entries.forEach(entry => {
                    if (entry.isIntersecting && entry.intersectionRatio > 0.1) {
                        const idx = entry.target.getAttribute('data-subject-idx');
                        document.querySelectorAll('.subject-nav-btn').forEach(btn => {
                            btn.classList.remove('active');
                        });
                        const activeBtn = document.querySelector(`.subject-nav-btn[data-subject-idx="${idx}"]`);
                        if (activeBtn) {
                            activeBtn.classList.add('active');
                        }
                    }
                });
            }, options);

            document.querySelectorAll('.subject-card').forEach(card => {
                observer.observe(card);
            });
        }

        renderSubjects();
        loadTheme();
        
        // Function to update all grade displays based on screen size
        function updateGradeDisplays() {
            subjects.forEach((subject, idx) => {
                const gradeElement = document.getElementById(`grade-${idx}`);
                if (gradeElement && gradeElement.textContent !== '-') {
                    const currentText = gradeElement.textContent;
                    // Extract grade and point from current text
                    const gradeMatch = currentText.match(/^(\w+)(\s*\(\d+(\.\d+)?\s*GP\))?$/);
                    if (gradeMatch) {
                        const grade = gradeMatch[1];
                        // Find the point value by looking at the grade
                        let point = 0;
                        if (currentText.includes('GP')) {
                            const pointMatch = currentText.match(/\((\d+(?:\.\d+)?)\s*GP\)/);
                            if (pointMatch) {
                                point = parseFloat(pointMatch[1]);
                            }
                        } else {
                            // If no GP in text, we need to calculate it from grade
                            const gradeInfo = getGrade(grade === 'A+' ? 95 : grade === 'A' ? 85 : grade === 'B+' ? 78 : grade === 'B' ? 72 : grade === 'C+' ? 65 : grade === 'C' ? 58 : grade === 'D+' ? 52 : grade === 'D' ? 45 : grade === 'F' ? 35 : 0);
                            point = gradeInfo.point;
                        }
                        
                        // Update display based on screen size
                        if (window.innerWidth <= 768) {
                            gradeElement.textContent = grade;
                        } else {
                            gradeElement.textContent = `${grade} (${point} GP)`;
                        }
                    }
                }
            });
        }
        
        // Update grade displays on window resize
        window.addEventListener('resize', updateGradeDisplays);
        
        // Hide loader after page is fully loaded
        window.addEventListener('load', () => {
            setTimeout(() => {
                const loader = document.getElementById('page-loader');
                loader.classList.add('hidden');
                setTimeout(() => {
                    loader.style.display = 'none';
                }, 500);
            }, 500);
        });
    </script>

    <!-- 
    ACCESSIBILITY & ACCEPTANCE CRITERIA CHECKLIST:
     All subjects verified against lecture plan PDF
     Attendance marks included for all subjects except Python Programming
     All assessment components match exactly with PDF
     Keyboard navigation: All tabs and buttons are keyboard accessible
     ARIA attributes: Proper role, aria-selected, aria-controls, aria-labelledby
     Focus visible: :focus-visible styles applied to all interactive elements
     Screen reader support: Live regions for SGPA updates, semantic HTML
     Color contrast: All text meets WCAG AA standards
     Reduced motion: Animations respect prefers-reduced-motion
     Responsive: Layout adapts at 768px breakpoint
     External estimation: Low (50%), Mid (70%), High (85%) scenarios
     CSV export functionality included
    -->

    <footer style="background: var(--bg-primary); color: #fff; padding: 20px 0; margin-top: 40px;">
        <div style="max-width: 1200px; margin: 0 auto; padding: 0 20px;">
            <!-- Footer content -->
            <div style="border-top: 1px solid #333; padding-top: 15px;">
                <div style="display: flex; justify-content: space-between; align-items: center; flex-wrap: wrap; gap: 20px;">
                    <!-- Copyright text on left -->
                    <div style="font-size: 14px; color: #ccc;">
                         2025. All Rights Reserved. No data Stored anywhere.<br>
                        Built by <strong>Md Dilshan</strong>, Beautified by <strong>DevRanbir </strong> with  for you
                    </div>
                    
                    <!-- GitHub icon on right -->
                    <div style="display: flex; align-items: center;">
                        <a href="https://github.com/Imdilshan/Internal-Marks-Calculator" style="color: #fff; text-decoration: none;" aria-label="GitHub">
                            <svg width="24" height="24" viewBox="0 0 24 24" fill="currentColor">
                                <path d="M12 0c-6.626 0-12 5.373-12 12 0 5.302 3.438 9.8 8.207 11.387.599.111.793-.261.793-.577v-2.234c-3.338.726-4.033-1.416-4.033-1.416-.546-1.387-1.333-1.756-1.333-1.756-1.089-.745.083-.729.083-.729 1.205.084 1.839 1.237 1.839 1.237 1.07 1.834 2.807 1.304 3.492.997.107-.775.418-1.305.762-1.604-2.665-.305-5.467-1.334-5.467-5.931 0-1.311.469-2.381 1.236-3.221-.124-.303-.535-1.524.117-3.176 0 0 1.008-.322 3.301 1.23.957-.266 1.983-.399 3.003-.404 1.02.005 2.047.138 3.006.404 2.291-1.552 3.297-1.23 3.297-1.23.653 1.653.242 2.874.118 3.176.77.84 1.235 1.911 1.235 3.221 0 4.609-2.807 5.624-5.479 5.921.43.372.823 1.102.823 2.222v3.293c0 .319.192.694.801.576 4.765-1.589 8.199-6.086 8.199-11.386 0-6.627-5.373-12-12-12z"/>
                            </svg>
                        </a>
                    </div>
                </div>
            </div>
        </div>
        
        <!-- Mobile responsive CSS -->
        <style>
            
            [data-theme="dark"] footer {
                background: #000 !important;
            }
            
            [data-theme="light"] footer div[style*="border-top"] {
                border-top-color: #e9ecef !important;
            }
            
            [data-theme="light"] footer div[style*="color: #ccc"] {
                color: #ffffff !important;
            }
            
            [data-theme="light"] footer a {
                color: #ffffff !important;
            }
            
            @media (max-width: 768px) {
                footer div[style*="justify-content: space-between"] {
                    flex-direction: column !important;
                    align-items: center !important;
                    text-align: center !important;
                    gap: 15px !important;
                }
                
                footer div[style*="gap: 15px"] {
                    margin-top: 0 !important;
                }
            }
        </style>
    </footer>
</body>
</html>